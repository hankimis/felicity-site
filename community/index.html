<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ïò®ÎπÑÌä∏ - Ïã§ÏãúÍ∞Ñ Ï±ÑÌåÖ Ï∞®Ìä∏</title>
    
    <!-- ÏΩòÏÜî Î°úÍ∑∏ Ìè≠Ï£º Î∞©ÏßÄ: Î™®Îì† Ïô∏Î∂Ä Ïä§ÌÅ¨Î¶ΩÌä∏ Î°úÎî© Ï†ÑÏóê log/info/debug Î¨¥Ïùå Ï≤òÎ¶¨ -->
    <script>
      (function(){
        try {
          var isDebug = /[?&]debug=1/.test(location.search) || localStorage.getItem('DEBUG') === '1';
          window.__IS_DEBUG__ = isDebug;
          if (!isDebug) {
            var noop = function(){};
            console.log = noop;
            console.info = noop;
            console.debug = noop;
          }
        } catch (_) {}
      })();
    </script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-functions-compat.js"></script>
    
    <!-- Font Awesome Ìè∞Ìä∏ Ïä§ÌÉÄÏùºÏãúÌä∏   -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Pretendard Ìè∞Ìä∏ Ïä§ÌÉÄÏùºÏãúÌä∏ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
    
    <!-- Base CSS -->
    <link rel="stylesheet" href="../css/base/_variables.css" />
    <link rel="stylesheet" href="../css/base/_reset.css" />
    <link rel="stylesheet" href="../css/base/_base.css" />
    
    <!-- Layout CSS -->
    <link rel="stylesheet" href="../css/layout/_header.css" />
    <link rel="stylesheet" href="../css/layout/_main.css" />
    
    <!-- Component CSS -->
    <link rel="stylesheet" href="../components/header/navbar.css" />
    <link rel="stylesheet" href="../css/components/_modal.css" />
    <link rel="stylesheet" href="../community/community.css" />
    <link rel="stylesheet" href="../css/components/chat.css" />
    <link rel="stylesheet" href="../css/components/chart.css" />
    <link rel="stylesheet" href="/components/bottom-nav/bottom-nav.css" />
    
    <!-- üî• Í≥†Îûò Ï∂îÏ†ÅÍ∏∞ CSS Ï∂îÍ∞Ä -->
    <link rel="stylesheet" href="../css/whale-tracker.css" />
    
    <!-- üî• TradingView Ïã¨Î≥º ÏïÑÏù¥ÏΩò CSS -->
    <link rel="stylesheet" href="../css/tradingview-symbol-icons.css" />
    
    <!-- Auth CSS -->
    <link rel="stylesheet" href="../auth.css" />
    
    <!-- Icons -->
    <link rel="icon" type="image/png" href="/onbit/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/onbit/favicon.svg" />
    <link rel="shortcut icon" href="/onbit/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/onbit/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Onbit" />
    <link rel="manifest" href="/onbit/site.webmanifest" />
    
    <!-- External Scripts -->
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    
    <!-- TradingView Charting Library -->
    <script type="text/javascript" src="../charting_library-master/charting_library/charting_library.standalone.js"></script>
    <script type="text/javascript" src="../charting_library-master/datafeeds/udf/dist/bundle.js"></script>
    
    
    <!-- Chart Scripts -->
    <script src="../js/binance-datafeed.js"></script>
    <script src="../js/multi-exchange-datafeed.js"></script>
    <script src="../js/chart-storage.js"></script>
    
    <script src="../js/market-data-manager.js"></script>
    <script src="../js/chart-save-manager.js"></script>
    
    <!-- Common Scripts -->
    <script src="../js/auth.js"></script>
    <script src="../js/websocket-manager.js"></script>
    <!-- Unified Header Loader -->
    <script src="../components/header/header-loader.js" defer></script>
    
    <!-- Firebase ÏÑ§Ï†ï -->
    <script>
        // Firebase ÏÑ§Ï†ïÏù¥ auth.jsÏóêÏÑú Î°úÎìúÎêòÍ∏∞Î•º Í∏∞Îã§Î¶º
        document.addEventListener('DOMContentLoaded', function() {
            // FirebaseÍ∞Ä ÏôÑÏ†ÑÌûà Ï¥àÍ∏∞ÌôîÎê† ÎïåÍπåÏßÄ ÎåÄÍ∏∞
            const waitForFirebase = () => {
                if (window.firebase && window.firebase.apps && window.firebase.apps.length > 0) {
            // Firebase Database Ï¥àÍ∏∞Ìôî ÌôïÏù∏
                    if (!window.database) {
                window.database = window.firebase.database();
                console.log('Community: Firebase Database Ï¥àÍ∏∞ÌôîÎê®');
            }
                } else {
                    console.log('Firebase Ï¥àÍ∏∞Ìôî ÎåÄÍ∏∞ Ï§ë...');
                    setTimeout(waitForFirebase, 100);
                }
            };
            waitForFirebase();
        });
    </script>
</head>
<body class="community-page">
    <!-- Header placeholder -->
    <div id="header-placeholder"></div>

    <main class="main-container">
        <div class="community-header" id="community-header">
            <div class="mh-left" id="mh-left">
            <div class="mh-symbol">
                    <img id="mh-coin-icon" alt="coin" />
                    <button id="mh-symbol-btn" class="mh-symbol-btn" aria-haspopup="listbox" aria-expanded="false">
                        <span id="mh-symbol-text">BTCUSDT Perp</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </button>
                    <!-- Ïã¨Î≥º ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥ -->
                <div id="mh-dropdown" class="mh-dropdown" role="dialog" aria-modal="true" aria-labelledby="mh-dd-title" style="display:none;">
                        <div class="mh-dd-header">
                            <div class="mh-dd-search">
                                <i class="fa-solid fa-magnifying-glass"></i>
                                <input id="mh-dd-search" type="text" placeholder="Search symbol..." autocomplete="off" />
                            </div>
                            <div class="mh-dd-tabs" role="tablist">
                                <button class="mh-dd-tab" data-tab="favorites">Favorites</button>
                                <button class="mh-dd-tab active" data-tab="futures">Futures</button>
                            </div>
                        </div>
                        <div class="mh-dd-list" id="mh-dd-list" role="listbox"></div>
                        <div class="mh-dd-footer">Ïã¨Î≥ºÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ Ï∞®Ìä∏ÏôÄ Ìó§ÎçîÍ∞Ä ÎèôÍ∏∞ÌôîÎê©ÎãàÎã§.</div>
                    </div>
                <!-- Î™®Î∞îÏùº ÎìúÎ°≠Îã§Ïö¥Ïö© Î∞±ÎìúÎ°≠ -->
                <div id="mh-dd-backdrop" style="display:none;"></div>
                </div>
            </div>
            <div class="mh-core" id="mh-core">
                <div class="mh-last">
                    <span id="mh-last-price">--</span>
                    <span id="mh-change" class="chg">--</span>
                </div>
                <div class="mh-metrics">
                    <div class="kv"><span>Mark Price</span><b id="mh-mark">--</b></div>
                    <div class="kv"><span>Index Price</span><b id="mh-index">--</b></div>
                    <div class="kv funding"><span>Funding/Countdown</span><b id="mh-funding">--</b><small id="mh-funding-eta">--:--:--</small></div>
                </div>
            </div>
            <div class="mh-right" id="mh-right">
                <div class="mh-stats">
                    <div class="kv"><span>24h High</span><b id="mh-high">--</b></div>
                    <div class="kv"><span>24h Low</span><b id="mh-low">--</b></div>
                    <div class="kv"><span>24h Volume</span><b id="mh-vol-usdt">--</b><small id="mh-vol-btc">-- (BTC)</small></div>
                </div>
            </div>
        </div>
        <div class="community-layout">
            <div class="community-layout-inner">
                <section class="chart-section">
                    <div class="chart-trading-layout">
                        <div class="chart-and-sidebar">
                        <div id="chart-container-wrapper">
                            <!-- Ï∞®Ìä∏ Ìó§ÎçîÏôÄ Î†àÏù¥ÏïÑÏõÉ Î≤ÑÌäºÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                            <div id="tradingview_chart"></div>
                            <div class="chart-loading" id="chart-loading">Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...</div>
                            </div>
                            <aside id="paper-trading-sidebar" class="paper-trading-sidebar">
                                <!-- Ï£ºÎ¨∏/Ïò§ÎçîÎ∂Å Ìå®ÎÑê -->
                                <div class="orderbook-and-trade">
                                    <!-- Î™®Î∞îÏùºÏóêÏÑú Ï£ºÎ¨∏Ìå®ÎÑêÏùÑ Ïó¨Í∏∞Î°ú Ïù¥ÎèôÏãúÌÇ¨ Ïä¨Î°Ø -->
                                    <div id="mobile-trade-slot" aria-live="polite"></div>
                                    <div class="orderbook-panel">
                                        <div class="panel-header">
                                            <div class="tabs" role="tablist">
                                                <button class="tab active" data-tab="orderbook">Ïò§ÎçîÎ∂Å</button>
                                                <button class="tab" data-tab="whale">Ïã§ÏãúÍ∞Ñ Í≥†Îûò ÌÉêÏßÄ</button>
                                            </div>
                                        </div>
                                        <div class="orderbook-body" id="orderbook-body">
                                            <div class="orderbook-table">
                                                <div class="ob-header">
                                                    <div>Price</div>
                                                    <div>Quantity (BTC)</div>
                                                    <div>Total (BTC)</div>
                                                </div>
                                                <div id="orderbook-rows" class="ob-rows"></div>
                                                <div class="ob-footer">
                                                    <div class="ratio">
                                                        <span class="buy-label">B <span id="ob-buy-ratio">--</span>%</span>
                                                        <div class="ratio-bar">
                                                            <span id="ob-buy-bar"></span>
                                                            <span id="ob-sell-bar"></span>
                                                        </div>
                                                        <span class="sell-label"><span id="ob-sell-ratio">--</span>% S</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="orderbook-body" id="whale-tab-body" style="display:none;">
                                            <div class="whale-trades-wrapper">
                                                <div id="whale-trades-container" class="whale-trades-container">
                                                    <div class="whale-trades-list"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Î™®Î∞îÏùºÏóêÏÑú Ï±ÑÌåÖÏùÑ ÏÇ¨Ïù¥ÎìúÎ∞îÎ°ú Ìï©ÏπòÍ∏∞ ÏúÑÌïú Ïä¨Î°Ø (ÌòÑÏû¨ ÎØ∏ÏÇ¨Ïö©) -->
                                    <div id="mobile-chat-slot" aria-live="polite"></div>
                                    <!-- Î™®Î∞îÏùºÏóêÏÑú Î≥¥Ïú† Ìè¨ÏßÄÏÖòÏùÑ Ï£ºÎ¨∏Ìå®ÎÑê ÏïÑÎûòÎ°ú Ïù¥ÎèôÏãúÌÇ§Îäî Ïä¨Î°Ø -->
                                    <div id="mobile-positions-slot" aria-live="polite"></div>
                                </div>
                            </aside>
                        </div>
                        <!-- ‚úÖ Ï∞®Ìä∏¬∑Ïò§ÎçîÎ∂Å ÏïÑÎûò Ìè¨ÏßÄÏÖò Î∞î -->
                            <!-- ÏõêÏúÑÏπò Î≥µÍ∑ÄÏö© ÏïµÏª§ (positions) -->
                            <div id="positions-home"></div>
                            <section id="positions-under-chart" class="positions-under-chart">
                                <div class="positions-bar-header">
                                    <div class="pos-tabs" role="tablist">
                                        <button class="pos-tab active" data-pos-tab="positions">Î≥¥Ïú† Ìè¨ÏßÄÏÖò</button>
                                        <button class="pos-tab" data-pos-tab="orders">Ïò§Ìîà Ïò§Îçî</button>
                                        <button class="pos-tab" data-pos-tab="history">Í±∞Îûò ÎÇ¥Ïó≠</button>
                                    </div>
                                    <div class="actions">
                                        <span id="pt-acct-eff" class="acct-eff"></span>
                                        <button id="pt-close-all" class="btn secondary">Ï†ÑÎüâ Ï≤≠ÏÇ∞</button>
                                    </div>
                                </div>
                                <div class="positions-table">
                                    <div class="positions-table-head positions-wide">
                                        <div>Í±∞ÎûòÏåç</div>
                                        <div>Ìè¨ÏßÄÏÖò</div>
                                        <div>ÏßÑÏûÖÍ∞Ä</div>
                                        <div>ÌòÑÏû¨Í∞Ä (Mark)</div>
                                        <div>ÏòàÏÉÅ Ï≤≠ÏÇ∞Í∞Ä</div>
                                        <div>ÎßàÏßÑ</div>
                                        <div>Í∞ÄÏö© ÏàòÎüâ (BTC)</div>
                                        <div>ÎØ∏Ïã§ÌòÑ ÏÜêÏùµ</div>
                                        <div>Ï±ÑÍµ¥ (Preview)</div>
                                        <div>ÏãúÏû•Í∞Ä Ï≤≠ÏÇ∞</div>
                                        <div>Close</div>
                                        <div>Ï≤≠ÏÇ∞ ÏàòÎüâ</div>
                                        <div>Ï≤≠ÏÇ∞</div>
                                    </div>
                                    <div id="positions-table-body" class="positions-table-body"></div>
                                </div>
                                <!-- Ïò§Ìîà Ïò§Îçî ÌÖåÏù¥Î∏î (Ï¥àÍ∏∞ Ïà®ÍπÄ) -->
                                <div class="orders-table" style="display:none;">
                                    <div class="orders-table-head">
                                        <div>Pairs</div>
                                        <div>Time</div>
                                        <div>Type</div>
                                        <div>Direction</div>
                                        <div>Avg. Price</div>
                                        <div>Filled | Size</div>
                                        <div>Trigger Price</div>
                                        <div>Order Price</div>
                                        <div>Frozen Margin</div>
                                        <div>Fee</div>
                                        <div>Action</div>
                                    </div>
                                    <div id="orders-table-body" class="orders-table-body"></div>
                                </div>
                                <!-- Í±∞Îûò ÎÇ¥Ïó≠ ÌÖåÏù¥Î∏î (Ï¥àÍ∏∞ Ïà®ÍπÄ) -->
                                <div class="history-table" style="display:none;">
                                    <div class="orders-table-head">
                                        <div>Pairs</div>
                                        <div>Time</div>
                                        <div>Direction</div>
                                        <div>Avg. Price | Type</div>
                                        <div>Filled | Size</div>
                                        <div>PnL | PnL%</div>
                                            <div>Fee</div>
                                            <div>Order Status | Order Number</div>
                                    </div>
                                    <div id="history-table-body" class="orders-table-body"></div>
                                </div>
                            </section>
                        
                        </div>
                </section>
                <!-- ÏõêÏúÑÏπò Î≥µÍ∑ÄÏö© ÏïµÏª§ -->
                <div id="chat-home"></div>
                <!-- Í≥†Îûò ÌÉêÏßÄÏôÄ Ï±ÑÌåÖÏùÑ ÏúÑÌïú Ïª®ÌÖåÏù¥ÎÑà -->
                <section class="whale-chat-container">
                    <!-- Ï£ºÎ¨∏ Ìå®ÎÑê Ïù¥Îèô: ÏÉÅÎã® Î∞∞Ïπò -->
                                    <div class="panel-header">
                                        <div class="tabs" role="tablist">
                            <button class="tab active" disabled>Trade</button>
                                        </div>
                                    </div>
                    <!-- Í∏∞Î≥∏ ÏúÑÏπò(Îç∞Ïä§ÌÅ¨ÌÜ±) - Î™®Î∞îÏùºÏóêÏÑúÎäî ÏÉÅÎã®Ïùò mobile-trade-slotÏúºÎ°ú Ïù¥Îèô -->
                    <div id="trade-panel-home">
                    <section class="trade-panel" style="padding:10px 14px;">
                        <div class="trade-header">
                            <div class="header-controls">
                                <button class="pt-compact-mode-btn" id="pt-open-margin-modal" aria-haspopup="dialog">
                                    <span id="pt-margin-mode-text">Cross</span>
                                </button>
                                <span class="pt-vdiv" aria-hidden="true"></span>
                                <button class="pt-compact-lev-btn" id="pt-open-lev-modal" aria-haspopup="dialog">
                                    <span class="pt-lev-long" id="pt-lev-long-label">20x</span>
                                    <span class="pt-lev-short" id="pt-lev-short-label">20x</span>
                                </button>
                            </div>
                            <div class="pt-openclose-toggle" id="pt-openclose-toggle" role="tablist">
                                <button type="button" class="sc active" data-mode="open">Open</button>
                                <button type="button" class="sc" data-mode="close">Close</button>
                            </div>
                        </div>

                        <div class="order-type-tabs" role="tablist">
                            <button class="order-type active" data-type="limit">Limit</button>
                            <button class="order-type" data-type="market">Market</button>
                        </div>

                        <div class="order-form" id="order-form">
                            <label class="field">
                                <span class="label">Price (USDT)</span>
                                <div class="input-wrap">
                                    <input type="number" step="any" id="pt-price" placeholder="ÏãúÏû•Í∞Ä" />
                                </div>
                            </label>
                            <label class="field">
                                <span class="label">Amount (BTC)</span>
                                <div class="input-wrap">
                                    <input type="text" id="pt-amount-percent" placeholder="0%" />
                                    <input type="number" step="0.0001" id="pt-amount" placeholder="> 0.0001 BTC" style="display:none;" />
                                </div>
                                <div id="pt-amount-error" class="field-error" style="display:none;">Order amount cannot be empty</div>
                            </label>
                            <div class="percent-slider">
                                <input type="range" id="pt-percent" min="0" max="100" step="1" value="0" />
                                <div class="ticks"><span>0%</span><span>25%</span><span>50%</span><span>75%</span><span>100%</span></div>
                            </div>

                            <div class="balances">
                                <div>Í∞ÄÏö© ÏûêÏÇ∞: <span id="pt-balance">-</span> USDT</div>
                                <div>Ìà¨ÏûÖ Ï¶ùÍ±∞Í∏à: <span id="pt-cost">-</span> USDT</div>
                            </div>
                            <div class="balances fee-preview">
                                <div>ÏàòÏàòÎ£å Í∏∞Ï§Ä: <span id="pt-fee-basis">--</span></div>
                                <div>ÏòàÏÉÅ ÏàòÏàòÎ£å: <span id="pt-fee-estimate">--</span> USDT</div>
                            </div>

                            <div class="action-buttons">
                                <button id="pt-open-long" class="btn long">Open Long</button>
                                <button id="pt-open-short" class="btn short">Open Short</button>
                            </div>
                        </div>
                    </section>
                    </div>
                    <!-- account-panel Ï†úÍ±∞ -->
                    
                    
                    <!-- Íµ¨Î∂ÑÏÑ† -->
                    <div class="section-divider"></div>
                    
                    <!-- Ïã§ÏãúÍ∞Ñ Ï±ÑÌåÖ ÏÑπÏÖò - ÎÜíÏù¥ ÌôïÏû• -->
                    <section class="chat-section" style="flex: 1;">
                        <div class="chat-section-header">
                            <h2>Ïã§ÏãúÍ∞Ñ Ï±ÑÌåÖ</h2>
                            <div class="chat-header-controls">
                                <div class="chat-users-count">
                                    <i class="fas fa-user"></i>
                                    <span id="chat-users-count">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="chat-wrapper">
                            <div id="chat-messages"></div>
                            <form id="chat-form" class="chat-input-form">
                                <input type="text" id="message-input" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." autocomplete="off">
                                <button type="submit">Ï†ÑÏÜ°</button>
                            </form>
                        </div>
                    </section>
                </section>
            </div>
        </div>
    </main>

    <!-- Í≥†Îûò Í±∞Îûò ÏÑ§Ï†ï Î™®Îã¨ -->
    <div id="whale-settings-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Í≥†Îûò Í±∞Îûò Ï∂îÏ†Å ÏÑ§Ï†ï</h2>
                <button class="modal-close" id="close-whale-settings">&times;</button>
            </div>
            <div class="modal-body">
                <div id="whale-settings-list">
                    <!-- ÏÑ§Ï†ï Ìï≠Î™©Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-whale-settings" class="btn btn-primary">ÏÑ§Ï†ï Ï†ÄÏû•</button>
            </div>
        </div>
    </div>

    <!-- Margin Mode Modal (pt- Ï†ëÎëêÏÇ¨Î°ú Ï∂©Îèå Î∞©ÏßÄ) -->
    <div id="pt-margin-modal" class="pt-modal" role="dialog" aria-modal="true" aria-labelledby="pt-margin-modal-title" hidden>
        <div class="pt-modal-content" role="document">
            <div class="pt-modal-header">
                <h2 id="pt-margin-modal-title">Margin Mode</h2>
                <button type="button" class="pt-close" id="pt-close-margin-modal" aria-label="Close">&times;</button>
            </div>
            <div class="pt-modal-body">
                <label class="pt-radio">
                    <input type="radio" name="pt-margin-mode" value="cross" checked>
                    <b>Cross Mode</b>
                    <div class="pt-desc">All positions share the futures account margin. In liquidation, wallet margin may be consumed.</div>
                </label>
                <label class="pt-radio">
                    <input type="radio" name="pt-margin-mode" value="isolated">
                    <b>Isolated Mode</b>
                    <div class="pt-desc">Margin is assigned per position. If margin falls below maintenance, only that position is liquidated.</div>
                </label>
            </div>
            <div class="pt-modal-footer">
                <button type="button" class="pt-btn pt-btn-ghost" id="pt-margin-cancel">Cancel</button>
                <button type="button" class="pt-btn pt-btn-primary" id="pt-margin-confirm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Leverage Modal -->
    <div id="pt-lev-modal" class="pt-modal" role="dialog" aria-modal="true" aria-labelledby="pt-lev-modal-title" hidden>
        <div class="pt-modal-content" role="document">
            <div class="pt-modal-header">
                <h2 id="pt-lev-modal-title">Adjust Leverage</h2>
                <button type="button" class="pt-close" id="pt-close-lev-modal" aria-label="Close">&times;</button>
            </div>
            <div class="pt-modal-body">
                <div class="pt-lev-sync">
                    <label>
                        <input type="checkbox" id="pt-lev-sync" checked>
                        Long/Short Sync
                    </label>
                </div>
                <div class="pt-lev-group">
                    <div class="pt-lev-row">
                        <div class="pt-lev-title">Long</div>
                        <input type="number" class="pt-lev-value-input pt-lev-long" id="pt-lev-long-value" min="1" max="100" step="1" value="20" />
                    </div>
                    <input type="range" class="pt-lev-range" id="pt-lev-long-range" min="1" max="100" step="1" value="20" />
                    <div class="pt-lev-ticks"><span>1x</span><span>25x</span><span>50x</span><span>75x</span><span>100x</span></div>
                </div>
                <div class="pt-lev-group">
                    <div class="pt-lev-row">
                        <div class="pt-lev-title">Short</div>
                        <input type="number" class="pt-lev-value-input pt-lev-short" id="pt-lev-short-value" min="1" max="100" step="1" value="20" />
                    </div>
                    <input type="range" class="pt-lev-range" id="pt-lev-short-range" min="1" max="100" step="1" value="20" />
                    <div class="pt-lev-ticks"><span>1x</span><span>25x</span><span>50x</span><span>75x</span><span>100x</span></div>
                </div>
            </div>
            <div class="pt-modal-footer">
                <button type="button" class="pt-btn pt-btn-ghost" id="pt-lev-cancel">Cancel</button>
                <button type="button" class="pt-btn pt-btn-primary" id="pt-lev-confirm">Confirm</button>
            </div>
        </div>
    </div>



    <!-- Í≥†Îûò Ï∂îÏ†ÅÍ∏∞ Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    <script src="../js/analysis/whale-tracker.js" type="module"></script>
    
    <!-- Î™®ÏùòÌà¨Ïûê ÏÑ§Ï†ï -->
    <script src="../js/paper-config.js"></script>
    <script src="../js/symbol-store.js"></script>
    <script src="../js/orderbook-engine.js"></script>
    <!-- ÏãúÏÑ∏ Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨ -->
    <script src="../js/paper-market.js"></script>
    <!-- Î¶¨Ïä§ÌÅ¨ Í¥ÄÎ¶¨ ÏóîÏßÑ -->
    <script src="../js/paper-risk.js"></script>
    <!-- Í±∞Îûò UI Ï≤òÎ¶¨ -->
    <script src="../js/paper-ui.js"></script>
    <!-- Ï£ºÎ¨∏ Ï≤òÎ¶¨ ÏóîÏßÑ -->
    <script src="../js/paper-order.js"></script>
    <!-- Ïò®Îπó Ï±ÑÍµ¥ Î°úÏßÅ -->
    <script type="module" src="../js/onbit-miner.js"></script>
    <!-- Î©îÏù∏ Î™®ÏùòÌà¨Ïûê ÏóîÏßÑ -->
    <script src="../js/paper-trading.js"></script>
    <!-- Í±∞Îûò ÏïåÎ¶º Í∏∞Îä• -->
    <script src="../js/trade-notifier.js"></script>
    <!-- Ïª§ÎÆ§ÎãàÌã∞ ÌéòÏù¥ÏßÄ -->
    <script src="../js/community.js"></script>
    <!-- ÎßàÏºì Ìó§Îçî -->
    <script src="../js/market-header.js"></script>
    <!-- Ïª§ÎÆ§ÎãàÌã∞ Ï±ÑÌåÖ -->
    <script src="../js/community-chat.js"></script>
    
    
    
    <!-- Margin Mode Modal Ïä§ÌÅ¨Î¶ΩÌä∏: ÏïàÏ†Ñ Î∞îÏù∏Îî© + ÏóîÏßÑ ÎèôÍ∏∞Ìôî -->
    <script>
      (function(){
        function qs(id){ return document.getElementById(id); }
        function safe(fn){ try{ fn(); }catch(_){} }

        function getEngine(){
          return window.paperTrading || null;
        }
        function getModeFromEngine(){
          const eng = getEngine();
          let m = eng?.state?.marginMode;
          if (!m) {
            try { m = localStorage.getItem('pt_mode'); } catch(_) {}
          }
          return (m === 'isolated' ? 'isolated' : 'cross');
        }
        function setModeToEngine(mode){
          const normalized = (mode === 'isolated' ? 'isolated' : 'cross');
          const eng = getEngine();
          if (eng) {
            eng.state.marginMode = normalized;
            safe(()=> eng.saveState && eng.saveState());
          }
          try { localStorage.setItem('pt_mode', normalized); } catch(_) {}
        }

        function openModal(){
          const modal = qs('pt-margin-modal'); if (!modal) return;
          modal.hidden = false;
          // Ïï†ÎãàÎ©îÏù¥ÏÖò ÌÅ¥ÎûòÏä§Î°ú ÏßÑÏûÖ
          requestAnimationFrame(()=> modal.classList.add('is-open'));
          setTimeout(()=> qs('pt-close-margin-modal')?.focus(), 0);
        }
        function closeModal(){
          const modal = qs('pt-margin-modal'); if (!modal) return;
          // Î∂ÄÎìúÎüΩÍ≤å Îã´Ìûò
          modal.classList.remove('is-open');
          modal.classList.add('is-closing');
          setTimeout(()=>{ modal.hidden = true; modal.classList.remove('is-closing'); }, 280);
        }

        function syncUI(){
          const label = qs('pt-margin-mode-text');
          const mode = getModeFromEngine();
          if (label) label.textContent = (mode === 'isolated' ? 'Isolated' : 'Cross');
          const radios = document.querySelectorAll('input[name="pt-margin-mode"]');
          radios.forEach(r => { r.checked = (r.value === mode); });
          // Ïπ¥Îìú ÏÑ†ÌÉù Í∞ïÏ°∞ Ïä§ÌÉÄÏùº
          document.querySelectorAll('.pt-radio').forEach(card => {
            const input = card.querySelector('input[name="pt-margin-mode"]');
            if (input) card.classList.toggle('selected', input.checked);
          });
        }

        function bind(){
          const openBtnWrap = qs('pt-open-margin-modal');
          if (openBtnWrap && !openBtnWrap.__bound){
            openBtnWrap.addEventListener('click', openModal);
            openBtnWrap.__bound = true;
          }
          const closeBtn = qs('pt-close-margin-modal');
          if (closeBtn && !closeBtn.__bound){
            closeBtn.addEventListener('click', closeModal);
            closeBtn.__bound = true;
          }
          const cancelBtn = qs('pt-margin-cancel');
          if (cancelBtn && !cancelBtn.__bound){
            cancelBtn.addEventListener('click', closeModal);
            cancelBtn.__bound = true;
          }
          const confirmBtn = qs('pt-margin-confirm');
          if (confirmBtn && !confirmBtn.__bound){
            confirmBtn.addEventListener('click', function(){
              const selected = document.querySelector('input[name="pt-margin-mode"]:checked')?.value || 'cross';
              setModeToEngine(selected);
              const label = qs('pt-margin-mode-text');
              if (label) label.textContent = (selected === 'isolated' ? 'Isolated' : 'Cross');
              closeModal();
            });
            confirmBtn.__bound = true;
          }
          // ÎùºÎîîÏò§ Ïπ¥Îìú ÌÅ¥Î¶≠ Ïãú ÏÑ†ÌÉù Í∞ïÏ°∞Îßå ÏóÖÎç∞Ïù¥Ìä∏ (ÏóîÏßÑ ÏÉÅÌÉúÎäî Confirm Ïãú Î∞òÏòÅ)
          document.querySelectorAll('.pt-radio input[name="pt-margin-mode"]').forEach(input => {
            if (!input.__bound) {
              input.addEventListener('change', () => {
                const current = document.querySelector('input[name="pt-margin-mode"]:checked');
                document.querySelectorAll('.pt-radio').forEach(card => {
                  const i = card.querySelector('input[name="pt-margin-mode"]');
                  if (i) card.classList.toggle('selected', i === current);
                });
              });
              input.__bound = true;
            }
          });
          const modal = qs('pt-margin-modal');
          if (modal && !modal.__bound){
            modal.addEventListener('click', (e)=>{ if (e.target === modal) closeModal(); });
            document.addEventListener('keydown', (e)=>{ if (!modal.hidden && (e.key === 'Escape' || e.key === 'Esc')) closeModal(); });
            modal.__bound = true;
          }
        }

        if (document.readyState === 'loading'){
          document.addEventListener('DOMContentLoaded', () => { syncUI(); bind(); });
        } else {
          syncUI(); bind();
        }

        let tries = 0;
        const iv = setInterval(()=>{
          tries++;
          syncUI();
          if (getEngine() || tries > 30) clearInterval(iv);
        }, 100);

        // ================== Leverage Modal ==================
        function getLevDefaults(){
          let longLev = 20, shortLev = 20, sync = true;
          try {
            const sl = Number(localStorage.getItem('pt_lev_long'));
            const ss = Number(localStorage.getItem('pt_lev_short'));
            const sy = localStorage.getItem('pt_lev_sync');
            if (isFinite(sl) && sl>=1 && sl<=200) longLev = sl;
            if (isFinite(ss) && ss>=1 && ss<=200) shortLev = ss;
            if (sy === '0') sync = false; else if (sy === '1') sync = true;
          } catch(_) {}
          // ÏóîÏßÑ Í∞íÏù¥ Ï°¥Ïû¨ÌïòÎ©¥ Ïö∞ÏÑ† Ï†ÅÏö©
          const eng = getEngine();
          if (eng && isFinite(eng.state?.leverage)) {
            longLev = shortLev = Math.max(1, Math.min(200, Number(eng.state.leverage)));
          }
          return { longLev, shortLev, sync };
        }

        function setLevToEngineAndStore(longLev, shortLev, sync){
          longLev = Math.max(1, Math.min(100, Number(longLev)||20));
          shortLev = Math.max(1, Math.min(100, Number(shortLev)||20));
          try {
            localStorage.setItem('pt_lev_long', String(longLev));
            localStorage.setItem('pt_lev_short', String(shortLev));
            localStorage.setItem('pt_lev_sync', sync ? '1' : '0');
            // Í∏∞Ï°¥ Îã®Ïùº Î†àÎ≤ÑÎ¶¨ÏßÄ ÌÇ§ÏôÄ Í∏∞Ï°¥ ÏÇ¨Ïù¥ÎìúÎ∞î ÏûÖÎ†•ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            localStorage.setItem('pt_lev', String(sync ? longLev : longLev));
          } catch(_) {}
          const eng = getEngine();
          if (eng) {
            eng.state.leverage = sync ? longLev : longLev; // ÎåÄÌëúÍ∞í
            eng.state.leverageLong = longLev;
            eng.state.leverageShort = shortLev;
            safe(()=> eng.saveState && eng.saveState());
            // Í∏∞Ï°¥ ÏûÖÎ†•/Ïä¨ÎùºÏù¥Îçî ÎèôÍ∏∞Ìôî
            const s = document.getElementById('lev-percent');
            const v = document.getElementById('lev-value');
            const pctFromLev = (lv) => Math.round(((lv-1)/99)*100);
            if (s) s.value = String(pctFromLev(eng.state.leverage));
            if (v && v.tagName === 'INPUT') v.value = String(eng.state.leverage);
            // ÌîÑÎ¶¨Î∑∞ Ï¶âÏãú Í∞±Ïã†
            try { eng.updateAmountFromPercent && eng.updateAmountFromPercent(); } catch(_) {}
            try { eng.updateCostPreview && eng.updateCostPreview(); } catch(_) {}
          }
        }

        function syncLevUI(){
          const { longLev, shortLev, sync } = getLevDefaults();
          const longLabel = qs('pt-lev-long-label');
          const shortLabel = qs('pt-lev-short-label');
          if (longLabel) longLabel.textContent = `${longLev}x`;
          if (shortLabel) shortLabel.textContent = `${shortLev}x`;
          const longVal = qs('pt-lev-long-value');
          const shortVal = qs('pt-lev-short-value');
          const longRange = qs('pt-lev-long-range');
          const shortRange = qs('pt-lev-short-range');
          const syncChk = qs('pt-lev-sync');
          if (longVal) longVal.value = String(longLev);
          if (shortVal) shortVal.value = String(shortLev);
          if (longRange) longRange.value = String(longLev);
          if (shortRange) shortRange.value = String(shortLev);
          if (syncChk) syncChk.checked = !!sync;
          if (shortRange) shortRange.disabled = !!sync;
        }

        function openLevModal(){ const m = qs('pt-lev-modal'); if (!m) return; syncLevUI(); m.hidden = false; requestAnimationFrame(()=> m.classList.add('is-open')); setTimeout(()=> qs('pt-close-lev-modal')?.focus(),0); }
        function closeLevModal(){ const m = qs('pt-lev-modal'); if (!m) return; m.classList.remove('is-open'); m.classList.add('is-closing'); setTimeout(()=>{ m.hidden = true; m.classList.remove('is-closing'); }, 280); }

        // Î∞îÏù∏Îî©
        const levBtn = qs('pt-open-lev-modal');
        if (levBtn && !levBtn.__bound){ levBtn.addEventListener('click', openLevModal); levBtn.__bound = true; }
        const levClose = qs('pt-close-lev-modal');
        if (levClose && !levClose.__bound){ levClose.addEventListener('click', closeLevModal); levClose.__bound = true; }
        const levCancel = qs('pt-lev-cancel');
        if (levCancel && !levCancel.__bound){ levCancel.addEventListener('click', closeLevModal); levCancel.__bound = true; }
        const levConfirm = qs('pt-lev-confirm');
        if (levConfirm && !levConfirm.__bound){
          levConfirm.addEventListener('click', () => {
            const syncChk = qs('pt-lev-sync');
            const sync = !!(syncChk && syncChk.checked);
            const longRange = qs('pt-lev-long-range');
            const shortRange = qs('pt-lev-short-range');
            const longLev = Number(longRange?.value||20);
            const shortLev = Number(shortRange?.value||longLev);
            setLevToEngineAndStore(longLev, shortLev, sync);
            syncLevUI();
            closeLevModal();
          });
          levConfirm.__bound = true;
        }
        const lr = qs('pt-lev-long-range');
        const sr = qs('pt-lev-short-range');
        const syncChk = qs('pt-lev-sync');
        if (syncChk && !syncChk.__bound){
          syncChk.addEventListener('change', ()=>{
            if (sr) sr.disabled = !!syncChk.checked;
          });
          syncChk.__bound = true;
        }
        function previewRecalc(usingValue){ try { const eng = getEngine(); if (!eng) return; if (isFinite(usingValue)) eng.state.leverage = Number(usingValue); eng.updateAmountFromPercent && eng.updateAmountFromPercent(); eng.updateCostPreview && eng.updateCostPreview(); } catch(_) {} }
        if (lr && !lr.__bound){ lr.addEventListener('input', ()=>{ const v = Math.max(1, Math.min(100, Number(lr.value||20))); lr.value = String(v); const lv = qs('pt-lev-long-value'); if (lv) lv.value = String(v); if (syncChk?.checked && sr){ sr.value = String(v); const sv = qs('pt-lev-short-value'); if (sv) sv.value = String(v); } previewRecalc(v); }); lr.__bound = true; }
        if (sr && !sr.__bound){ sr.addEventListener('input', ()=>{ const v = Math.max(1, Math.min(100, Number(sr.value||20))); sr.value = String(v); const sv = qs('pt-lev-short-value'); if (sv) sv.value = String(v); previewRecalc(v); }); sr.__bound = true; }
        // ÏûÖÎ†• Î∞ïÏä§ ÏßÅÏ†ë ÏûÖÎ†• Ïó∞Îèô
        const lvIn = qs('pt-lev-long-value');
        const svIn = qs('pt-lev-short-value');
        if (lvIn && !lvIn.__bound){ lvIn.addEventListener('input', ()=>{ let v = Math.max(1, Math.min(100, Number(lvIn.value||20))); lvIn.value = String(v); if (lr) lr.value = String(v); if (syncChk?.checked && svIn && sr){ svIn.value = String(v); sr.value = String(v); } previewRecalc(v); }); lvIn.__bound = true; }
        if (svIn && !svIn.__bound){ svIn.addEventListener('input', ()=>{ let v = Math.max(1, Math.min(100, Number(svIn.value||20))); svIn.value = String(v); if (sr) sr.value = String(v); previewRecalc(v); }); svIn.__bound = true; }

        // Open/Close segmented toggle
        const oc = document.getElementById('pt-openclose-toggle');
        if (oc && !oc.__bound){
          oc.addEventListener('click', (e)=>{
            const btn = e.target && e.target.closest('button.sc'); if (!btn) return;
            oc.querySelectorAll('button.sc').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
            const mode = btn.getAttribute('data-mode') || 'open';
            try { const eng = getEngine(); if (eng) eng.actionMode = mode; } catch(_) {}
          });
          oc.__bound = true;
        }

        // Ï¥àÍ∏∞ UI ÎèôÍ∏∞Ìôî
        syncLevUI();
      })();
    </script>
    <script src="/components/bottom-nav/bottom-nav.js" defer></script>
    <!-- Î†àÏù¥ÏïÑÏõÉ Ïû¨Î∞∞Ïπò: Î™®Î∞îÏùºÏóêÏÑú Ï£ºÎ¨∏Ìå®ÎÑêÏùÑ Ïò§ÎçîÎ∂Å ÏòÜÏúºÎ°ú Ïù¥Îèô -->
    <script>
      (function(){
        function relocateTradePanel(){
          try{
            var trade = document.querySelector('.trade-panel');
            var slot = document.getElementById('mobile-trade-slot');
            var home = document.getElementById('trade-panel-home');
            var chat = document.querySelector('.whale-chat-container');
            var chatSlot = document.getElementById('mobile-chat-slot');
            var chatHome = document.getElementById('chat-home');
            var posSection = document.getElementById('positions-under-chart');
            var posSlot = document.getElementById('mobile-positions-slot');
            var posHome = document.getElementById('positions-home');
            if(!trade || !slot || !home) return;
            var isMobile = window.matchMedia('(max-width: 768px)').matches;
            if (isMobile){
              if (!slot.contains(trade)) slot.insertAdjacentElement('afterbegin', trade);
              try { trade.style.display = 'block'; } catch(_){ }
              // Ï±ÑÌåÖÏùÄ ÏÇ¨Ïù¥ÎìúÎ∞îÎ°ú Ïù¥ÎèôÏãúÌÇ§ÏßÄ ÏïäÏùå (ÏõêÏúÑÏπò Ïú†ÏßÄ)
              if (chat && chatHome && chatHome.nextElementSibling !== chat) {
                chatHome.insertAdjacentElement('afterend', chat);
              }
              // Î≥¥Ïú† Ìè¨ÏßÄÏÖòÏùÑ Ï£ºÎ¨∏Ìå®ÎÑê Î∞îÎ°ú ÏïÑÎûòÎ°ú Ïù¥Îèô
              if (posSection && posSlot && !posSlot.contains(posSection)) {
                posSlot.appendChild(posSection);
              }
            } else {
              if (!home.contains(trade)) home.appendChild(trade);
              try { trade.style.display = ''; } catch(_){ }
              // Ï±ÑÌåÖ ÏõêÏúÑÏπò Ïú†ÏßÄ
              if (chat && chatHome && chatHome.nextElementSibling !== chat) {
                chatHome.insertAdjacentElement('afterend', chat);
              }
              // Ìè¨ÏßÄÏÖòÏùÑ ÏõêÏúÑÏπò Î≥µÍ∑Ä
              if (posSection && posHome && posHome.nextElementSibling !== posSection) {
                posHome.insertAdjacentElement('afterend', posSection);
              }
            }
          }catch(_){ }
        }
        window.addEventListener('resize', relocateTradePanel);
        document.addEventListener('DOMContentLoaded', relocateTradePanel);
        // Ï≤´ Î†åÎçî ÌÉÄÏù¥Î∞ç Ïù¥Ïäà ÎåÄÏùë: ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ Ïó¨Îü¨ Î≤à Î≥¥Ï†ï
        window.addEventListener('load', function(){
          var tries = 0; var iv = setInterval(function(){ relocateTradePanel(); if (++tries > 15) clearInterval(iv); }, 150);
        });
      })();
    </script>
    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const body = document.body;
        const menuButton = document.getElementById('mobile-menu-button');
        const closeButton = document.getElementById('mobile-menu-close');
        const mobileMenu = document.getElementById('mobile-menu');

        if (menuButton && mobileMenu) {
            menuButton.addEventListener('click', () => {
                mobileMenu.classList.add('is-open');
                body.classList.add('mobile-menu-open');
            });
        }

        if (closeButton && mobileMenu) {
            closeButton.addEventListener('click', () => {
                mobileMenu.classList.remove('is-open');
                body.classList.remove('mobile-menu-open');
            });
        }

        // Ï∞®Ìä∏ Ï†ÄÏû• Í¥ÄÎ¶¨ Î™®Îã¨ Ïù¥Î≤§Ìä∏
        const chartSaveModal = document.getElementById('chart-save-modal');
        const manualSaveBtn = document.getElementById('manual-save-btn');
        const refreshChartsBtn = document.getElementById('refresh-charts-btn');
        const savedChartsList = document.getElementById('saved-charts-list');

        // ÏàòÎèô Ï†ÄÏû• Î≤ÑÌäº
        if (manualSaveBtn) {
            manualSaveBtn.addEventListener('click', async () => {
                if (window.chartSaveManager) {
                    const success = await window.chartSaveManager.manualSave();
                    if (success) {
                        refreshSavedChartsList();
                    }
                }
            });
        }

        // Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ® Î≤ÑÌäº
        if (refreshChartsBtn) {
            refreshChartsBtn.addEventListener('click', refreshSavedChartsList);
        }

        // Ï†ÄÏû•Îêú Ï∞®Ìä∏ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
        async function refreshSavedChartsList() {
            if (!window.chartSaveManager || !savedChartsList) return;

            try {
                const charts = await window.chartSaveManager.getSavedCharts();
                
                if (charts.length === 0) {
                    savedChartsList.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--text-color-secondary);">
                            <i class="fas fa-chart-line" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                            <p>Ï†ÄÏû•Îêú Ï∞®Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§.</p>
                        </div>
                    `;
                    return;
                }

                savedChartsList.innerHTML = charts.map(chart => `
                    <div class="saved-chart-item" style="
                        display: flex; 
                        align-items: center; 
                        justify-content: space-between; 
                        padding: 12px; 
                        border: 1px solid var(--border-color); 
                        border-radius: 8px; 
                        margin-bottom: 8px;
                        background: var(--card-bg);
                    ">
                        <div>
                            <div style="font-weight: 600; color: var(--text-color);">
                                ${chart.symbol} (${chart.interval})
                            </div>
                            <div style="font-size: 12px; color: var(--text-color-secondary);">
                                ${chart.timestamp ? chart.timestamp.toLocaleString() : 'Ïïå Ïàò ÏóÜÏùå'}
                            </div>
                        </div>
                        <div>
                            <button class="chart-settings-btn secondary" onclick="loadSavedChart('${chart.id}')" style="margin-right: 8px;">
                                <i class="fas fa-download"></i> Î∂àÎü¨Ïò§Í∏∞
                            </button>
                            <button class="chart-settings-btn" onclick="deleteSavedChart('${chart.id}')" style="background: var(--error-color);">
                                <i class="fas fa-trash"></i> ÏÇ≠Ï†ú
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Ï∞®Ìä∏ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ® Ïã§Ìå®:', error);
                savedChartsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--error-color);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 16px;"></i>
                        <p>Î™©Î°ùÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</p>
                    </div>
                `;
            }
        }

        // Ï†ÑÏó≠ Ìï®ÏàòÎ°ú Îì±Î°ù
        window.loadSavedChart = async (chartId) => {
            // Íµ¨ÌòÑ ÏòàÏ†ï
            console.log('Ï∞®Ìä∏ Î∂àÎü¨Ïò§Í∏∞:', chartId);
        };

        window.deleteSavedChart = async (chartId) => {
            if (confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                if (window.chartSaveManager) {
                    const success = await window.chartSaveManager.deleteSavedChart(chartId);
                    if (success) {
                        refreshSavedChartsList();
                    }
                }
            }
        };

        // Î™®Îã¨Ïù¥ Ïó¥Î¶¥ Îïå Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                    if (chartSaveModal && chartSaveModal.style.display !== 'none') {
                        refreshSavedChartsList();
                    }
                }
            });
        });

        if (chartSaveModal) {
            observer.observe(chartSaveModal, { attributes: true });
        }


      });
    </script>
    <div id="rocket-overlay" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; pointer-events:none; z-index:2000;"></div>
</body>
</html> 