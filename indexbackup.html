<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Onbit - ì•”í˜¸í™”í ê±°ë˜ì†Œ ì •ë³´ ë° ì‹¤ì‹œê°„ ë¶„ì„</title>
  <meta name="description" content="ì‹¤ì‹œê°„ ì•”í˜¸í™”í ë¶„ì„, ê³ ë˜ ì¶”ì , ê±°ë˜ì†Œ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” Onbitì—ì„œ ìµœì‹  ì½”ì¸ ì‹œì¥ ë™í–¥ì„ í™•ì¸í•˜ì„¸ìš”.">
  
  <!-- Preconnect to external domains for faster loading -->
  <link rel="preconnect" href="https://www.gstatic.com">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://api.binance.com">
  <link rel="preconnect" href="https://s3.tradingview.com">
  <link rel="dns-prefetch" href="https://s3.tradingview.com">
  <link rel="preload" href="https://s3.tradingview.com/tv.js" as="script">
  
  <!-- Critical CSS - Only essential above-the-fold styles -->
  <style>
    /* Critical CSS Variables */
    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --accent-blue: #3b82f6;
      --primary-color: #3b82f6;
      --border-default: #e2e8f0;
      --shadow-light: rgba(0, 0, 0, 0.08);
    }

    [data-theme="dark"] {
      --bg-primary: #1a1a1a;
      --bg-secondary: #2a2a2a;
      --text-primary: #ffffff;
      --text-secondary: #cccccc;
    }

    /* Critical Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
      background-color: var(--bg-primary);
      color: var(--text-primary);
      transition: background-color 0.3s ease, color 0.3s ease;
      line-height: 1.6;
    }

    /* Critical Loading Animation */
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .loading-skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }

    /* Critical Main Banner */
    .main-banner {
      height: 500px;
      width: 100%;
      background: #2a2a2a;
      color: #ffffff;
      margin-bottom: 40px;
      position: relative;
      overflow: hidden;
    }
    </style>
  
  <!-- Index Page Specific CSS -->
  <link rel="stylesheet" href="css/pages/_index.css">

  </style>
  
  <!-- Favicon and icons -->
  <link rel="icon" type="image/png" href="/onbit/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/onbit/favicon.svg" />
  <link rel="shortcut icon" href="/onbit/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/onbit/apple-touch-icon.png" />
  <link rel="manifest" href="/onbit/site.webmanifest" />
  
  <!-- Load critical CSS files -->
  <link rel="stylesheet" href="css/style.css">

    <link rel="stylesheet" href="css/popup-banner.css">
  <link rel="stylesheet" href="auth.css">
  
  <!-- Preload critical fonts -->
  <link rel="preload" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard-dynamic-subset.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard-dynamic-subset.css"></noscript>
  
  <!-- Defer Font Awesome -->
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"></noscript>

  <!-- Critical scripts that must load immediately -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
  <script src="https://s3.tradingview.com/tv.js" async defer></script>
</head>
<body>
  <!-- Header placeholder -->
  <div id="header-placeholder"></div>
  
  <!-- ë©”ì¸ ë°°ë„ˆ ì„¹ì…˜ -->
  <section class="main-banner">
    <video class="banner-video" autoplay muted loop playsinline>
      <source src="/assets/mainbannerbackground/Video_Ready_White_Particle_Loop.mp4" type="video/mp4">
    </video>
    <div class="banner-content">
      <div class="banner-text">
        <h1 class="banner-title">
          <span class="highlight">í˜ì´ë°±</span>ìœ¼ë¡œ ë” ë§ì€ ìˆ˜ìµì„!
        </h1>
        <p class="banner-subtitle">
          ì œíœ´ ê±°ë˜ì†Œ ì´ìš© ì‹œ ê±°ë˜ ìˆ˜ìˆ˜ë£Œì˜ ì¼ë¶€ë¥¼ í˜ì´ë°±ìœ¼ë¡œ ëŒë ¤ë°›ìœ¼ì„¸ìš”
        </p>
        <div class="banner-features">
          <div class="feature-item">
            <i class="fas fa-percentage"></i>
            <span>ìµœëŒ€ 40% ìˆ˜ìˆ˜ë£Œ í˜ì´ë°±</span>
          </div>
          <div class="feature-item">
            <i class="fas fa-clock"></i>
            <span>ì‹¤ì‹œê°„ ì •ì‚°</span>
          </div>
          <div class="feature-item">
            <i class="fas fa-shield-alt"></i>
            <span>ì•ˆì „í•œ ê±°ë˜ ë³´ì¥</span>
          </div>
        </div>
        <div class="banner-cta">
          <a href="/affiliated/" class="cta-button primary">
            <i class="fas fa-rocket"></i>
            ì œíœ´ ê±°ë˜ì†Œ ë³´ê¸°
          </a>
          <a href="/affiliated/payback-calculator/" class="cta-button secondary">
            <i class="fas fa-calculator"></i>
            í˜ì´ë°± ê³„ì‚°í•˜ê¸°
          </a>
        </div>
      </div>
      <div class="banner-exchanges">
        <div class="exchanges-grid">
          <a href="/affiliated/" class="exchange-item">
            <img src="/assets/logoicon/binance.webp" alt="Binance" class="exchange-logo">
            <span class="exchange-name">Binance</span>
          </a>
          <a href="/affiliated/bitget/" class="exchange-item">
            <img src="/assets/logoicon/bitget.png" alt="Bitget" class="exchange-logo">
            <span class="exchange-name">Bitget</span>
          </a>
          <a href="/affiliated/okx/" class="exchange-item">
            <img src="/assets/logoicon/okx.png" alt="OKX" class="exchange-logo">
            <span class="exchange-name">OKX</span>
          </a>
          <a href="/affiliated/bitmex/" class="exchange-item">
            <img src="/assets/logoicon/bitmex.png" alt="BitMEX" class="exchange-logo">
            <span class="exchange-name">BitMEX</span>
          </a>
          <a href="/affiliated/lbank/" class="exchange-item">
            <img src="/assets/logoicon/lbank.png" alt="LBank" class="exchange-logo">
            <span class="exchange-name">LBank</span>
          </a>
        </div>
      </div>
    </div>
  </section>
  
    <!-- ì‹¤ì‹œê°„ ì¶”ì  ì„¹ì…˜ -->
    <section class="realtime-section">
      <div class="realtime-grid">
        <!-- ì‹¤ì‹œê°„ ë¡±ìˆ ë¹„ìœ¨ -->
        <div class="longshort-container">
          <div class="section-header">
            <h3 class="section-title">
              <i class="fas fa-chart-pie"></i>
              ì‹¤ì‹œê°„ ë¡±ìˆ ë¹„ìœ¨
            </h3>
            <div class="longshort-controls">
              <select id="longshort-symbol" class="symbol-select">
                <option value="BTCUSDT">BTC/USDT</option>
                <option value="ETHUSDT">ETH/USDT</option>
                <option value="ADAUSDT">ADA/USDT</option>
                <option value="SOLUSDT">SOL/USDT</option>
                <option value="XRPUSDT">XRP/USDT</option>
              </select>
              </div>
            </div>
          <div class="longshort-content">
            <div class="longshort-ratio-display">
              <div class="ratio-circle" id="ratio-circle">
                <div class="ratio-text">
                  <span class="long-ratio" id="long-ratio">52%</span>
                  <span class="vs">vs</span>
                  <span class="short-ratio" id="short-ratio">48%</span>
              </div>
            </div>
            </div>
            <div class="longshort-details">
              <div class="position-info long-info">
                <div class="position-label">
                  <i class="fas fa-arrow-up"></i>
                  <span>ë¡± í¬ì§€ì…˜</span>
                </div>
                <div class="position-value" id="long-percentage">52.3%</div>
                <div class="position-amount" id="long-amount">$1,234,567</div>
              </div>
              <div class="position-info short-info">
                <div class="position-label">
                  <i class="fas fa-arrow-down"></i>
                  <span>ìˆ í¬ì§€ì…˜</span>
                </div>
                <div class="position-value" id="short-percentage">47.7%</div>
                <div class="position-amount" id="short-amount">$987,654</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ì‹¤ì‹œê°„ ê³ ë˜ ê±°ë˜ -->
        <div class="whale-container">
          <div class="section-header">
            <h3 class="section-title">
              <i class="fas fa-fish"></i>
              ì‹¤ì‹œê°„ ê³ ë˜ ê±°ë˜
            </h3>
            <div class="whale-controls">
              <span class="whale-status">ì—°ê²° ì¤‘...</span>
              <button class="whale-settings-btn" id="whale-settings-btn">
                <i class="fas fa-cog"></i>
              </button>
            </div>
          </div>
          <div class="whale-trades-container" id="whale-trades-container">
            <div class="whale-trades-list">
              <!-- ê³ ë˜ ê±°ë˜ ë°ì´í„°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
          </div>
        </div>
        
        <!-- ë³µë¦¬ ê³„ì‚°ê¸° -->
        <div class="compound-calculator-container">
          <div class="section-header">
            <h3 class="section-title">
              <i class="fas fa-calculator"></i>
              ë³µë¦¬ ê³„ì‚°ê¸°
            </h3>
          </div>
          <div class="compound-calculator-content">
            <div class="calculator-form">
              <div class="form-row">
                <label for="initial-amount">ì´ˆê¸° ê¸ˆì•¡ (â‚©)</label>
                <input type="text" id="initial-amount" value="1,000,000" placeholder="1,000,000">
              </div>
              <div class="form-row">
                <label for="investment-years">ë³µë¦¬ íšŸìˆ˜ (ê¸°ê°„)</label>
                <input type="number" id="investment-years" value="20" min="1" max="50">
              </div>
              <div class="form-row">
                <label for="annual-return">ìˆ˜ìµë¥  (%)</label>
                <input type="text" id="annual-return" value="5%" placeholder="5%">
              </div>
              <button class="calculate-btn" id="calculate-btn">
                ê³„ì‚°í•˜ê¸°
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ì°¨íŠ¸ ë° ì •ë³´ ì„¹ì…˜ -->
    <section class="dashboard-section">
      <div class="dashboard-grid">
        <!-- ì°¨íŠ¸ ì˜ì—­ -->
        <div class="chart-container">
          <div class="section-header">
            <h3 class="section-title">ì‹¤ì‹œê°„ ì°¨íŠ¸</h3>
            <div class="chart-controls">
              <select id="chart-symbol" class="chart-select">
                <option value="BTCUSDT">Bitcoin (BTC)</option>
                <option value="ETHUSDT">Ethereum (ETH)</option>
                <option value="BNBUSDT">BNB (BNB)</option>
                <option value="SOLUSDT">Solana (SOL)</option>
                <option value="ADAUSDT">Cardano (ADA)</option>
                <option value="XRPUSDT">XRP (XRP)</option>
                <option value="DOGEUSDT">Dogecoin (DOGE)</option>
                <option value="AVAXUSDT">Avalanche (AVAX)</option>
                <option value="DOTUSDT">Polkadot (DOT)</option>
                <option value="MATICUSDT">Polygon (MATIC)</option>
                <option value="LINKUSDT">Chainlink (LINK)</option>
                <option value="UNIUSDT">Uniswap (UNI)</option>
                <option value="LTCUSDT">Litecoin (LTC)</option>
                <option value="BCHUSDT">Bitcoin Cash (BCH)</option>
                <option value="ATOMUSDT">Cosmos (ATOM)</option>
              </select>
              <select id="chart-timeframe" class="chart-select timeframe-select">
                <option value="1">1ë¶„</option>
                <option value="5">5ë¶„</option>
                <option value="15">15ë¶„</option>
                <option value="60" selected>1ì‹œê°„</option>
                <option value="240">4ì‹œê°„</option>
                <option value="1D">1ì¼</option>
              </select>
            </div>
          </div>
          <div class="tradingview-widget-container">
          <div id="tradingview_chart">
            <!-- ì°¨íŠ¸ ë¡œë”© ì¤‘ í‘œì‹œ -->
            <div id="chart-loading" style="display: flex; align-items: center; justify-content: center; height: 400px; background: var(--card-bg); border-radius: 8px; color: var(--text-secondary);">
              <div style="text-align: center;">
                <div class="loading-spinner" style="width: 40px; height: 40px; border: 3px solid var(--border-color); border-top: 3px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                <div>ì°¨íŠ¸ ë¡œë”©ì¤‘...</div>
              </div>
            </div>
          </div>
          </div>
        </div>
        
        <!-- ë‰´ìŠ¤ ì˜ì—­ -->
        <div class="news-container">
          <div class="section-header">
            <h3 class="section-title">
              <i class="fas fa-newspaper"></i>
              í¬ë¦½í†  ë‰´ìŠ¤
            </h3>
            <div class="news-header-controls">
              <button class="refresh-news-btn" id="refresh-news" title="ë‰´ìŠ¤ ìƒˆë¡œê³ ì¹¨">
              <i class="fas fa-sync-alt"></i>
            </button>
              <a href="news/" class="view-all-news-btn" title="ëª¨ë“  ë‰´ìŠ¤ ë³´ê¸°">
                <i class="fas fa-external-link-alt"></i>
                ì „ì²´ë³´ê¸°
              </a>
            </div>
          </div>
          <div class="news-list" id="news-list">
            <div class="loading-news">
              <div class="loading-spinner"></div>
              <span>ìµœì‹  ë‰´ìŠ¤ ë¡œë”© ì¤‘...</span>
            </div>
          </div>
        </div>
        
        <!-- ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ì¹´ë“œ ì˜ì—­ -->
        <div class="indices-container">
          <div class="section-header">
            <h3 class="section-title">
              <i class="fas fa-calendar-alt"></i>
              ì‹¤ì‹œê°„ ì´ë²¤íŠ¸
            </h3>
            <div class="news-header-controls">
              <button class="refresh-indices-btn" id="refresh-events">
              <i class="fas fa-sync-alt"></i>
            </button>
              <a href="event-board.html" class="view-all-news-btn" title="ëª¨ë“  ì´ë²¤íŠ¸ ë³´ê¸°">
                <i class="fas fa-external-link-alt"></i>
                ì „ì²´ë³´ê¸°
              </a>
          </div>
          </div>
          <div class="indices-content" id="events-content">
            <div class="loading-indices">
              <div class="loading-spinner"></div>
              <span>ì´ë²¤íŠ¸ ë°ì´í„° ë¡œë”© ì¤‘...</span>
            </div>
          </div>
        </div>
      </div>
    </section>

  <!-- ì‹¤ì‹œê°„ ì½”ì¸ ì‹œì„¸ í…Œì´ë¸” ì„¹ì…˜ -->
    <section class="crypto-table-section">
      <div class="section-header">
        <h3 class="section-title">
          <i class="fas fa-coins"></i>
          ì‹¤ì‹œê°„ ì½”ì¸ ì‹œì„¸
        </h3>
        <div class="table-controls">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="coin-search" placeholder="ì½”ì¸ ê²€ìƒ‰...">
          </div>
          <button class="refresh-btn" id="refresh-data">
            <i class="fas fa-sync-alt"></i>
          </button>
        </div>
      </div>
      
      <div class="crypto-table-wrapper">
                 <div class="table-tabs">
           <button class="tab-btn active" data-category="all">ì „ì²´</button>
           <button class="tab-btn" data-category="gainers">ìƒìŠ¹</button>
           <button class="tab-btn" data-category="losers">í•˜ë½</button>
         </div>
        
        <div class="crypto-table-container">
                     <table class="crypto-table" id="crypto-table">
             <thead>
               <tr>
                 <th class="sortable rank-col" data-sort="rank">ìˆœìœ„</th>
                 <th class="sortable name-col" data-sort="name">ì½”ì¸</th>
                 <th class="sortable price-col" data-sort="price">ê°€ê²©</th>
                 <th class="sortable change-col" data-sort="change1h">ê°€ê²©(1H%)</th>
                 <th class="sortable change-col" data-sort="change24h">ê°€ê²©(24H %)</th>
                 <th class="sortable funding-col" data-sort="fundingRate">ìê¸ˆ ì¡°ë‹¬ ë¹„ìœ¨</th>
                 <th class="sortable volume-col" data-sort="volume">24H ë³¼ë¥¨($)</th>
                 <th class="sortable oi-col" data-sort="openInterest">OI($)</th>
                 <th class="sortable oi-change-col" data-sort="oiChange1h">OI(1H%)</th>
                 <th class="sortable oi-change-col" data-sort="oiChange4h">OI(4H%)</th>
                 <th class="sortable market-col" data-sort="marketCap">Market Cap($)</th>
                 <th class="sortable liquidation-col" data-sort="liquidation1h">1H ì²­ì‚°($)</th>
                 <th class="sortable liquidation-col" data-sort="liquidation24h">24H ì²­ì‚°($)</th>
                 <th class="chart-col">ì°¨íŠ¸</th>
               </tr>
             </thead>
            <tbody id="crypto-table-body">
              <!-- ì½”ì¸ ë°ì´í„°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </tbody>
          </table>
        </div>
        
        <div class="table-pagination">
          <button class="page-btn" id="prev-page" disabled>ì´ì „</button>
          <span class="page-info" id="page-info">1 / 1</span>
          <button class="page-btn" id="next-page">ë‹¤ìŒ</button>
        </div>
      </div>
    </section>

  <!-- ê³ ë˜ ê±°ë˜ ì„¤ì • ëª¨ë‹¬ -->
  <div id="whale-settings-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ê³ ë˜ ê±°ë˜ ì¶”ì  ì„¤ì •</h2>
        <button class="modal-close" id="close-whale-settings">&times;</button>
      </div>
      <div class="modal-body">
        <div id="whale-settings-list">
          <!-- ì„¤ì • í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
      </div>
      <div class="modal-footer">
        <button id="save-whale-settings" class="btn btn-primary">ì„¤ì • ì €ì¥</button>
      </div>
    </div>
  </div>

  <!-- Footer placeholder -->
  <div id="footer-placeholder"></div>

  <!-- Scripts - Load in correct order -->
  <script src="js/auth.js"></script>
  <script src="components/header/header-loader.js"></script>
  <script src="js/footer-loader.js"></script>
  
<script src="js/popup-banner.js"></script>
  <script src="js/analysis/longshort-tracker.js" type="module"></script>
  <script src="js/analysis/whale-tracker.js" type="module"></script>
  <script src="js/compound-calculator.js" type="module"></script>
  <!-- html2canvas for modal capture -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script type="module">
    // Whale Tracker ì´ˆê¸°í™”
    import { WhaleTracker } from './js/analysis/whale-tracker.js';
    
    // DOM ë¡œë“œ í›„ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        try {
          window.whaleTracker = new WhaleTracker();
          console.log('Whale Tracker ì´ˆê¸°í™” ì™„ë£Œ');
        } catch (error) {
          console.error('Whale Tracker ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        }
      }, 1000);
    });
  </script>
  <script src="js/compound-calculator.js" type="module"></script>

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  
  <!-- Firebase SDK for Events -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { firebaseConfig } from './firebase-config.js';
    
    // Firebase ì´ˆê¸°í™”
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    // ì „ì—­ ë³€ìˆ˜ë¡œ Firebase ê°ì²´ë“¤ ë…¸ì¶œ (ë°”ì¸ë”© ìœ ì§€)
    window.firebaseDB = db;
    window.firebaseCollection = collection.bind(null, db);
    window.firebaseGetDocs = getDocs;
    window.firebaseQuery = query;
    window.firebaseOrderBy = orderBy;
    window.firebaseLimit = limit;
    
    // Firebase ì´ˆê¸°í™” ì™„ë£Œ í”Œë˜ê·¸
    window.firebaseInitialized = true;
    
    console.log('Firebase ì´ˆê¸°í™” ì™„ë£Œ');
    
    // Firebase ì´ˆê¸°í™” ì™„ë£Œ ì´ë²¤íŠ¸ ë°œìƒ
    window.dispatchEvent(new CustomEvent('firebaseInitialized'));
  </script>

  <script>
    // í˜ì´ì§€ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {

      
      // í˜ì´ì§€ë³„ ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
      if (typeof initializePage === 'function') {
        initializePage();
      }
      
      // TradingView ì°¨íŠ¸ ì¦‰ì‹œ ì´ˆê¸°í™”
      if (window.TradingView) {
        // ì„ íƒëœ ì‹¬ë³¼ë¡œ ì´ˆê¸°í™”
        const chartSymbol = document.getElementById('chart-symbol');
        const initialSymbol = chartSymbol ? chartSymbol.value : 'BTCUSDT';
        initializeTradingViewChart(initialSymbol);
      } else {
        // TradingView ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ì§§ì€ ê°„ê²©ìœ¼ë¡œ ì²´í¬
        let checkCount = 0;
        const checkTradingView = setInterval(() => {
          checkCount++;
          if (window.TradingView) {
            clearInterval(checkTradingView);
            // ì„ íƒëœ ì‹¬ë³¼ë¡œ ì´ˆê¸°í™”
            const chartSymbol = document.getElementById('chart-symbol');
            const initialSymbol = chartSymbol ? chartSymbol.value : 'BTCUSDT';
            initializeTradingViewChart(initialSymbol);
          } else if (checkCount > 50) { // 5ì´ˆ í›„ í¬ê¸°
            clearInterval(checkTradingView);
            console.warn('TradingView ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© íƒ€ì„ì•„ì›ƒ');
          }
        }, 100);
      }
    });
    
        // ì „ì—­ TradingView ìœ„ì ¯ ì¸ìŠ¤í„´ìŠ¤
    let tradingViewWidget = null;
    let currentChartSymbol = 'BTCUSDT';

    // í˜„ì¬ ì‹œê°„ í”„ë ˆì„ ì €ì¥
    let currentTimeframe = '1';

    // TradingView ì°¨íŠ¸ ì´ˆê¸°í™” í•¨ìˆ˜ (ìµœì í™”)
    function initializeTradingViewChart(symbol = 'BTCUSDT', interval = null) {
      const chartContainer = document.getElementById('tradingview_chart');
      if (!chartContainer) {
        console.warn('ì°¨íŠ¸ ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }

      try {
        // ë¡œë”© í‘œì‹œ ì œê±°
        const loadingElement = document.getElementById('chart-loading');
        if (loadingElement) {
          loadingElement.style.display = 'none';
        }
        
        // ê¸°ì¡´ ìœ„ì ¯ì´ ìˆë‹¤ë©´ ì œê±°
        if (tradingViewWidget) {
          try {
            tradingViewWidget.remove();
          } catch (e) {
            console.warn('ê¸°ì¡´ ìœ„ì ¯ ì œê±° ì¤‘ ì˜¤ë¥˜:', e);
          }
        }
        
        // ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
        chartContainer.innerHTML = '';
        
        const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';
        currentChartSymbol = symbol;
        
        // ì‹œê°„ í”„ë ˆì„ ì„¤ì • (intervalì´ ì œê³µë˜ë©´ ì‚¬ìš©, ì•„ë‹ˆë©´ í˜„ì¬ ì„¤ì • ì‚¬ìš©)
        const timeframe = interval || currentTimeframe;
        
        tradingViewWidget = new TradingView.widget({
          "autosize": true,
          "symbol": `BINANCE:${symbol}`,
          "interval": timeframe,
          "timezone": "Asia/Seoul",
          "theme": isDarkMode ? "dark" : "light",
          "style": "1",
          "locale": "ko",
          "toolbar_bg": isDarkMode ? "#1e222d" : "#f1f3f6",
          "enable_publishing": false,
          "hide_top_toolbar": true,
          "hide_legend": false,
          "hide_side_toolbar": false,
          "save_image": false,
          "container_id": "tradingview_chart",
          "disabled_features": [
            "use_localstorage_for_settings",
            "volume_force_overlay",
            "create_volume_indicator_by_default"
          ],
          "enabled_features": [
            "study_templates"
          ],
          "loading_screen": {
            "backgroundColor": isDarkMode ? "#1e222d" : "#ffffff",
            "foregroundColor": isDarkMode ? "#ffffff" : "#000000"
          },
          "overrides": {
            "paneProperties.background": isDarkMode ? "#1e222d" : "#ffffff",
            "paneProperties.vertGridProperties.color": isDarkMode ? "#363c4e" : "#e1e3e6",
            "paneProperties.horzGridProperties.color": isDarkMode ? "#363c4e" : "#e1e3e6"
          }
        });
        
      } catch (error) {
        console.error('TradingView ì°¨íŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        // ë°±ì—… ì°¨íŠ¸ í‘œì‹œ
        chartContainer.innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--text-secondary);">
            <div style="text-align: center;">
              <i class="fas fa-chart-line" style="font-size: 3rem; margin-bottom: 1rem;"></i>
              <div>ì°¨íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
          </div>
        `;
      }
    }

    // ë¶„ë´‰ ë³€ê²½ í•¨ìˆ˜
    function changeTimeframe(timeframe) {
      currentTimeframe = timeframe;
      
      // ë“œë¡­ë‹¤ìš´ ê°’ ì—…ë°ì´íŠ¸
      const timeframeSelect = document.getElementById('chart-timeframe');
      if (timeframeSelect) {
        timeframeSelect.value = timeframe;
      }
      
      // í˜„ì¬ ì‹¬ë³¼ë¡œ ì°¨íŠ¸ ì¬ì´ˆê¸°í™”
      const chartSymbol = document.getElementById('chart-symbol');
      const symbol = chartSymbol ? chartSymbol.value : 'BTCUSDT';
      
      // ë¡œë”© í‘œì‹œ
      const chartContainer = document.getElementById('tradingview_chart');
      if (chartContainer) {
        chartContainer.innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--text-secondary);">
            <div style="text-align: center;">
              <div class="loading-spinner" style="width: 40px; height: 40px; border: 3px solid var(--border-color); border-top: 3px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
              <div>ë¶„ë´‰ ë³€ê²½ ì¤‘...</div>
            </div>
          </div>
        `;
      }
      
      setTimeout(() => {
        initializeTradingViewChart(symbol, timeframe);
      }, 300);
    }

    // ì°¨íŠ¸ ì‹¬ë³¼ ë³€ê²½ í•¨ìˆ˜
    function changeChartSymbol(symbol) {
      // ë¡œë”© í‘œì‹œ
      const chartContainer = document.getElementById('tradingview_chart');
      if (chartContainer) {
        chartContainer.innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--text-secondary);">
            <div style="text-align: center;">
              <div class="loading-spinner" style="width: 40px; height: 40px; border: 3px solid var(--border-color); border-top: 3px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
              <div>ì°¨íŠ¸ ë³€ê²½ ì¤‘...</div>
            </div>
          </div>
        `;
      }
      
      // ìƒˆë¡œìš´ ì‹¬ë³¼ë¡œ ì°¨íŠ¸ ì¬ì´ˆê¸°í™” (í˜„ì¬ ì‹œê°„ í”„ë ˆì„ ìœ ì§€)
      setTimeout(() => {
        initializeTradingViewChart(symbol, currentTimeframe);
      }, 500);
    }

    // ë‹¤í¬ëª¨ë“œ ì´ˆê¸°í™”
    function initializeDarkMode() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
      
      const themeToggle = document.querySelector('.theme-toggle');
      if (themeToggle) {
        themeToggle.addEventListener('click', () => {
          const currentTheme = document.documentElement.getAttribute('data-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          
          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
          
          // TradingView ì°¨íŠ¸ í…Œë§ˆ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
          setTimeout(() => {
            if (tradingViewWidget && currentChartSymbol) {
              initializeTradingViewChart(currentChartSymbol, currentTimeframe);
            }
          }, 100);
        });
      }
    }

    // ë‹¤í¬ëª¨ë“œ ì´ˆê¸°í™”
    initializeDarkMode();
    
    // í…Œë§ˆ ë³€ê²½ ê°ì§€ (í—¤ë”ì˜ í…Œë§ˆ í† ê¸€ ë²„íŠ¼ìš©)
    document.addEventListener('themeChanged', () => {
      setTimeout(() => {
        if (tradingViewWidget && currentChartSymbol) {
          initializeTradingViewChart(currentChartSymbol, currentTimeframe);
        }
      }, 100);
    });

    // ëŒ€ì‹œë³´ë“œ ê´€ë¦¬ í´ë˜ìŠ¤
    class Dashboard {
      constructor() {
        this.currentSymbol = 'BTCUSDT';
        this.tvWidget = null;
        this.isChartReady = false;
        this.init();
      }
      
      init() {
        this.initNews();
        this.initIndices();
        this.bindEvents();
      }
      
      initNews() {
        this.loadNews();
        setInterval(() => {
          this.loadNews();
        }, 300000); // 5ë¶„ë§ˆë‹¤ ë‰´ìŠ¤ ì—…ë°ì´íŠ¸
      }
      
      async loadNews() {
        const newsList = document.getElementById('news-list');
        const CACHE_KEY = 'indexNewsFeedsCache';
        const CACHE_DURATION_MS = 3 * 60 * 1000; // 3ë¶„ ìºì‹œ
        
        // 1. ìºì‹œ í™•ì¸ ë° ì¦‰ì‹œ í‘œì‹œ (ë¹ ë¥¸ ë¡œë”©)
        try {
          const cached = localStorage.getItem(CACHE_KEY);
          if (cached) {
            const cacheData = JSON.parse(cached);
            const age = Date.now() - cacheData.timestamp;
            
            // ìºì‹œê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ í‘œì‹œ (ë§Œë£Œë˜ì–´ë„ ì¼ë‹¨ í‘œì‹œ)
            if (cacheData.data && cacheData.data.length > 0) {
              console.log('ğŸ“° ë©”ì¸í˜ì´ì§€ ìºì‹œëœ ë‰´ìŠ¤ ì¦‰ì‹œ í‘œì‹œ');
              this.displayNews(cacheData.data);
              
              // ìºì‹œê°€ ë§Œë£Œë˜ì—ˆìœ¼ë©´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìƒˆ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
              if (age >= CACHE_DURATION_MS) {
                console.log('ğŸ“° ë©”ì¸í˜ì´ì§€ ìºì‹œ ë§Œë£Œ, ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìƒˆ ë°ì´í„° ë¡œë”©');
                setTimeout(() => this.loadFreshNews(true), 100);
              }
              return;
            }
          }
        } catch (e) {
          console.warn('ë©”ì¸í˜ì´ì§€ ìºì‹œ ì½ê¸° ì‹¤íŒ¨:', e);
        }
        
        // ìºì‹œê°€ ì—†ìœ¼ë©´ ë¡œë”© ë©”ì‹œì§€ í‘œì‹œí•˜ê³  ìƒˆ ë°ì´í„° ë¡œë“œ
        newsList.innerHTML = `
          <div class="loading-news">
            <div class="loading-spinner"></div>
            <span>ìµœì‹  ë‰´ìŠ¤ ë¡œë”© ì¤‘...</span>
          </div>
        `;
        await this.loadFreshNews(false);
      }
      
      async loadFreshNews(isBackgroundUpdate = false) {
        const newsList = document.getElementById('news-list');
        const CACHE_KEY = 'indexNewsFeedsCache';
        
        try {
          const feeds = [
            // í•œêµ­ ì•”í˜¸í™”í ë‰´ìŠ¤ ì†ŒìŠ¤ (ìš°ì„ ìˆœìœ„ ìˆœ - ë¹ ë¥¸ ì†ŒìŠ¤ ìš°ì„ )
            { url: 'https://kr.cointelegraph.com/rss', source: 'cointelegraph' },
            { url: 'https://www.tokenpost.kr/rss', source: 'tokenpost' },
            { url: 'https://www.blockmedia.co.kr/feed', source: 'blockmedia' },
            { url: 'https://bloomingbit.io/rss.xml', source: 'bloomingbit' },
            { url: 'https://kr.investing.com/rss/news.rss', source: 'investing' },
            { url: 'https://www.blockstreet.co.kr/feed', source: 'blockstreet' },
            { url: 'https://cryptonews.com/kr/feed/', source: 'cryptonews' },
            { url: 'https://cryptodnes.bg/kr/feed/', source: 'cryptodnes' },
            { url: 'https://zdnet.co.kr/feed', source: 'zdnet' }
          ];

          // ë¹ ë¥¸ ë¡œë”©ì„ ìœ„í•œ ë‹¨ê³„ë³„ ì²˜ë¦¬
          const fastFeeds = feeds.slice(0, 4); // ë¹ ë¥¸ í”¼ë“œ 4ê°œ
          const slowFeeds = feeds.slice(4); // ë‚˜ë¨¸ì§€ í”¼ë“œ

          // 1ë‹¨ê³„: ë¹ ë¥¸ í”¼ë“œë“¤ ë¨¼ì € ë¡œë“œ (2ì´ˆ íƒ€ì„ì•„ì›ƒ)
          const fastPromises = fastFeeds.map(feed => 
            Promise.race([
              this.fetchAndParseFeed(feed),
              new Promise((_, reject) => 
                setTimeout(() => reject(new Error('Timeout')), 2000)
              )
            ]).catch(error => {
              console.warn(`${feed.source} í”¼ë“œ ë¡œë”© ì‹¤íŒ¨:`, error.message);
              return []; // ì‹¤íŒ¨í•œ í”¼ë“œëŠ” ë¹ˆ ë°°ì—´ ë°˜í™˜
            })
          );

          const fastResults = await Promise.all(fastPromises);
          
          let allNews = [];
          let successCount = 0;
          
          // ë¹ ë¥¸ í”¼ë“œ ê²°ê³¼ ì²˜ë¦¬
          fastResults.forEach((result, index) => {
            const feedName = fastFeeds[index].source;
            if (result && result.length > 0) {
              allNews.push(...result);
              successCount++;
              console.log(`âœ… ${feedName}: ${result.length}ê°œ ë‰´ìŠ¤ ë¡œë“œ`);
            }
          });

          // ë¹ ë¥¸ í”¼ë“œ ê²°ê³¼ê°€ ìˆìœ¼ë©´ ì¦‰ì‹œ í‘œì‹œ (ë°±ê·¸ë¼ìš´ë“œ ì—…ë°ì´íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°)
          if (allNews.length > 0 && !isBackgroundUpdate) {
            // ì¤‘ë³µ ì œê±° ë° ì •ë ¬
            const uniqueNews = this.removeDuplicateNews(allNews);
            uniqueNews.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
            
            // ìºì‹œ ì €ì¥
            const cacheData = {
              timestamp: Date.now(),
              data: uniqueNews.slice(0, 8) // ë©”ì¸í˜ì´ì§€ìš© 8ê°œë§Œ
            };
            localStorage.setItem(CACHE_KEY, JSON.stringify(cacheData));
            
            this.displayNews(cacheData.data);
            
            console.log(`ğŸ“° ë©”ì¸í˜ì´ì§€ ë¹ ë¥¸ ë¡œë”© ì™„ë£Œ: ${successCount}ê°œ ì†ŒìŠ¤ì—ì„œ ${uniqueNews.length}ê°œ ë‰´ìŠ¤`);
          }

          // 2ë‹¨ê³„: ë‚˜ë¨¸ì§€ í”¼ë“œë“¤ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë¡œë“œ (3ì´ˆ íƒ€ì„ì•„ì›ƒ)
          const slowPromises = slowFeeds.map(feed => 
            Promise.race([
              this.fetchAndParseFeed(feed),
              new Promise((_, reject) => 
                setTimeout(() => reject(new Error('Timeout')), 3000)
              )
            ]).catch(error => {
              console.warn(`${feed.source} í”¼ë“œ ë¡œë”© ì‹¤íŒ¨:`, error.message);
              return [];
            })
          );

          const slowResults = await Promise.all(slowPromises);
          
          // ë‚˜ë¨¸ì§€ í”¼ë“œ ê²°ê³¼ ì²˜ë¦¬
          slowResults.forEach((result, index) => {
            const feedName = slowFeeds[index].source;
            if (result && result.length > 0) {
              allNews.push(...result);
              successCount++;
              console.log(`âœ… ${feedName}: ${result.length}ê°œ ë‰´ìŠ¤ ë¡œë“œ`);
            }
          });

          // ìµœì¢… ê²°ê³¼ ì²˜ë¦¬
          if (allNews.length === 0) {
            throw new Error('ëª¨ë“  ë‰´ìŠ¤ í”¼ë“œë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }

          // ì¤‘ë³µ ì œê±° ë° ì •ë ¬
          const uniqueNews = this.removeDuplicateNews(allNews);
          uniqueNews.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
          
          // ìºì‹œ ì €ì¥
          const cacheData = {
            timestamp: Date.now(),
            data: uniqueNews.slice(0, 8) // ë©”ì¸í˜ì´ì§€ìš© 8ê°œë§Œ
          };
          localStorage.setItem(CACHE_KEY, JSON.stringify(cacheData));
          
          // ë°±ê·¸ë¼ìš´ë“œ ì—…ë°ì´íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ UI ì—…ë°ì´íŠ¸
          if (!isBackgroundUpdate) {
          this.displayNews(cacheData.data);
          } else {
            console.log(`ğŸ“° ë©”ì¸í˜ì´ì§€ ë°±ê·¸ë¼ìš´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${uniqueNews.length}ê°œ ë‰´ìŠ¤`);
          }
          
          console.log(`ğŸ“° ë©”ì¸í˜ì´ì§€ ë‰´ìŠ¤ ë¡œë”© ì™„ë£Œ: ${successCount}/${feeds.length} ì†ŒìŠ¤ ì„±ê³µ, ${uniqueNews.length}ê°œ ë‰´ìŠ¤`);
          
        } catch (error) {
          console.error('ë©”ì¸í˜ì´ì§€ ë‰´ìŠ¤ ë¡œë”© ì‹¤íŒ¨:', error);
          if (!isBackgroundUpdate) {
          this.displayFallbackNews();
          }
        }
      }
      
      // ì¤‘ë³µ ë‰´ìŠ¤ ì œê±° í•¨ìˆ˜
      removeDuplicateNews(newsArray) {
        const uniqueNewsMap = new Map();
        newsArray.forEach(item => {
          if (item.link && !uniqueNewsMap.has(item.link)) {
            uniqueNewsMap.set(item.link, item);
          }
        });
        return Array.from(uniqueNewsMap.values());
      }
      
      async fetchAndParseFeed({ url, source }) {
        const timeoutMs = 6000; // 6ì´ˆ íƒ€ì„ì•„ì›ƒ
        const maxRetries = 2; // ì¬ì‹œë„ íšŸìˆ˜
        
        // ë¹ ë¥¸ CORS í”„ë¡ì‹œ ì„œë¹„ìŠ¤ë“¤ (ì†ë„ ìˆœ)
        const proxyServices = [
          `https://corsproxy.io/?${encodeURIComponent(url)}`,
          `https://cors-proxy.htmldriven.com/?url=${encodeURIComponent(url)}`,
          `https://thingproxy.freeboard.io/fetch/${encodeURIComponent(url)}`
        ];
        
        for (let retry = 0; retry <= maxRetries; retry++) {
          const proxyUrl = proxyServices[retry % proxyServices.length];
        
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), timeoutMs);
          
            const response = await fetch(proxyUrl, {
            method: 'GET',
            signal: controller.signal,
            headers: {
                'Accept': 'application/rss+xml, application/xml, text/xml, */*',
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
            }
          });
          
          clearTimeout(timeoutId);
          
          if (response.ok) {
              const xmlText = await response.text();
              
              // ë¹ˆ ì‘ë‹µ ì²´í¬
              if (!xmlText || xmlText.trim().length === 0) {
                throw new Error('ë¹ˆ ì‘ë‹µ');
              }
              
              // RSS XML íŒŒì‹±
              const parser = new DOMParser();
              const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
              
              // íŒŒì‹± ì—ëŸ¬ ì²´í¬
              const parserError = xmlDoc.querySelector('parsererror');
              if (parserError) {
                throw new Error('XML íŒŒì‹± ì—ëŸ¬');
              }
              
              // RSS ì•„ì´í…œ ì¶”ì¶œ
              let items = Array.from(xmlDoc.querySelectorAll('item'));
              if (items.length === 0) {
                items = Array.from(xmlDoc.querySelectorAll('entry')); // Atom ì§€ì›
              }
              
              if (items.length > 0) {
                // ì²˜ë¦¬í•  ì•„ì´í…œ ê°œìˆ˜ ì œí•œ (ì„±ëŠ¥ í–¥ìƒ)
                const processedItems = items.slice(0, 20).map(item => {
                  // í•„ìˆ˜ ë°ì´í„°ë§Œ ì¶”ì¶œ
                  const title = item.querySelector('title')?.textContent?.trim() || '';
                  
                  // ë§í¬ ì¶”ì¶œ
                  let link = '';
                  const linkElement = item.querySelector('link');
                  if (linkElement) {
                    link = linkElement.textContent?.trim() || linkElement.getAttribute('href') || '';
                  }
                  
                  // ë°œí–‰ì¼ ì¶”ì¶œ
                  const pubDate = item.querySelector('pubDate')?.textContent?.trim() || 
                                 item.querySelector('published')?.textContent?.trim() ||
                                 item.querySelector('updated')?.textContent?.trim() ||
                                 new Date().toISOString();
                  
                  // ì„¤ëª… ì¶”ì¶œ (ê°„ì†Œí™”)
                  let description = '';
                  const descElement = item.querySelector('description') || 
                                    item.querySelector('content') ||
                                    item.querySelector('summary');
                  
                  if (descElement) {
                    description = descElement.textContent || descElement.innerHTML || '';
                  }
                  
                  // í…ìŠ¤íŠ¸ ì •ë¦¬ (ìµœì í™”)
                let contentSnippet = '';
                  if (description) {
                    contentSnippet = description
                      .replace(/<[^>]*>/g, '')
                      .replace(/&[^;]+;/g, ' ')
                      .replace(/\s+/g, ' ')
                      .trim()
                      .substring(0, 150); // ê¸¸ì´ ë‹¨ì¶•
                  }
                  
                  if (!contentSnippet.trim()) {
                    contentSnippet = title.substring(0, 80);
                  }
                  
                  // ì´ë¯¸ì§€ ì¶”ì¶œ (ê°„ì†Œí™”)
                  let imageUrl = '/img/default-news.jpg';
                  
                  // ê¸°ë³¸ì ì¸ ì´ë¯¸ì§€ ì†ŒìŠ¤ë§Œ í™•ì¸
                  const enclosure = item.querySelector('enclosure');
                  if (enclosure && enclosure.getAttribute('url') && 
                      enclosure.getAttribute('type')?.startsWith('image/')) {
                    imageUrl = enclosure.getAttribute('url');
                  } else {
                    // descriptionì—ì„œ ì²« ë²ˆì§¸ ì´ë¯¸ì§€ë§Œ ì¶”ì¶œ
                    const imgMatch = description.match(/<img[^>]+src=["']([^"']+)["']/i);
                    if (imgMatch && imgMatch[1] && imgMatch[1].startsWith('http')) {
                    imageUrl = imgMatch[1];
                  }
                }
                
                return {
                    title,
                    link,
                    pubDate,
                  content: contentSnippet,
                  image: imageUrl,
                    source
                };
              });
                
                return processedItems;
            }
            } else {
              throw new Error(`HTTP ${response.status}`);
          }
        } catch (error) {
            if (retry === maxRetries) {
              console.warn(`âŒ ${source}: ìµœì¢… ì‹¤íŒ¨ - ${error.message}`);
            }
            
            // ë¹ ë¥¸ ì¬ì‹œë„ (ëŒ€ê¸° ì‹œê°„ ë‹¨ì¶•)
            if (retry < maxRetries) {
              await new Promise(resolve => setTimeout(resolve, 500 * (retry + 1)));
            }
          }
        }
        
        return [];
      }
      
      displayFallbackNews() {
          const backupNews = [
            {
              title: "ë¹„íŠ¸ì½”ì¸ ê°€ê²© ë¶„ì„ ë° ì „ë§",
              link: "https://kr.cointelegraph.com/news/bitcoin-analysis",
            source: 'cointelegraph',
            content: "ìµœì‹  ë¹„íŠ¸ì½”ì¸ ê°€ê²© ë™í–¥ê³¼ ì „ë¬¸ê°€ë“¤ì˜ ë¶„ì„ì„ í™•ì¸í•˜ì„¸ìš”.",
              pubDate: new Date().toISOString(),
              image: '/img/default-news.jpg'
            },
            {
              title: "ì´ë”ë¦¬ì›€ 2.0 ì—…ë°ì´íŠ¸ í˜„í™©",
              link: "https://kr.cointelegraph.com/news/ethereum-2-update",
            source: 'cointelegraph',
            content: "ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬ì˜ ìµœì‹  ì—…ë°ì´íŠ¸ì™€ ê°œë°œ í˜„í™©ì„ ì•Œì•„ë³´ì„¸ìš”.",
              pubDate: new Date().toISOString(),
              image: '/img/default-news.jpg'
            },
            {
              title: "êµ­ë‚´ ì•”í˜¸í™”í ì‹œì¥ ë™í–¥",
              link: "https://www.tokenpost.kr/",
              source: 'tokenpost',
            content: "êµ­ë‚´ ì•”í˜¸í™”í ì‹œì¥ì˜ ìµœì‹  ë™í–¥ê³¼ ê·œì œ í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”.",
              pubDate: new Date().toISOString(),
              image: '/img/default-news.jpg'
            },
            {
              title: "ê¸€ë¡œë²Œ ì•”í˜¸í™”í ì‹œì¥ ë¶„ì„",
              link: "https://kr.investing.com/news/cryptocurrency",
            source: 'investing',
            content: "ì „ ì„¸ê³„ ì•”í˜¸í™”í ì‹œì¥ì˜ íŠ¸ë Œë“œì™€ íˆ¬ì ì „ë§ì„ ì‚´í´ë³´ì„¸ìš”.",
              pubDate: new Date().toISOString(),
              image: '/img/default-news.jpg'
            }
          ];
          
          this.displayNews(backupNews);
      }
      
      displayNews(newsData) {
        const newsList = document.getElementById('news-list');
        
        if (!newsData || newsData.length === 0) {
          newsList.innerHTML = `
            <div class="loading-news">
              <i class="fas fa-exclamation-triangle"></i>
              <span>ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</span>
              <button onclick="dashboard.loadNews()" style="margin-top: 0.5rem; padding: 0.25rem 0.5rem; border: 1px solid var(--border-strong); border-radius: 4px; background: var(--bg-primary); color: var(--text-secondary); cursor: pointer;">
                <i class="fas fa-sync-alt"></i> ë‹¤ì‹œ ì‹œë„
              </button>
            </div>
          `;
            return;
          }
        
        newsList.innerHTML = newsData.map(news => {
          const sourceName = this.getSourceName(news.source);
          const timeAgo = this.getRelativeTime(news.pubDate);
          
          return `
            <div class="news-item" onclick="window.open('${news.link}', '_blank')">
              <div class="news-item-content">
              <div class="news-title">${news.title}</div>
                ${news.content ? `<div class="news-content">${news.content}</div>` : ''}
              <div class="news-meta">
                <span class="news-source">${sourceName}</span>
                  <span class="news-time">${timeAgo}</span>
              </div>
              </div>
              ${news.image ? `<div class="news-image"><img src="${news.image}" alt="ë‰´ìŠ¤ ì´ë¯¸ì§€" loading="lazy" onerror="this.parentElement.style.display='none'"></div>` : ''}
            </div>
          `;
        }).join('');
      }
      
      getSourceName(source) {
        const sourceNames = {
          'cointelegraph': 'ì½”ì¸í…”ë ˆê·¸ë˜í”„',
          'tokenpost': 'í† í°í¬ìŠ¤íŠ¸',
          'blockmedia': 'ë¸”ë¡ë¯¸ë””ì–´',
          'bloomingbit': 'ë¸”ë£¨ë°ë¹„íŠ¸',
          'investing': 'Investing.com',
          'blockstreet': 'ë¸”ë¡ìŠ¤íŠ¸ë¦¬íŠ¸',
          'cryptonews': 'Cryptonews Korea',
          'cryptodnes': 'Cryptodnes',
          'zdnet': 'ZDNet Korea'
        };
        return sourceNames[source] || source;
      }
      
      getRelativeTime(dateString) {
        const now = new Date();
        const date = new Date(dateString);
        const diffInSeconds = Math.floor((now - date) / 1000);
        
        if (diffInSeconds < 60) {
          return 'ë°©ê¸ˆ ì „';
        } else if (diffInSeconds < 3600) {
          return `${Math.floor(diffInSeconds / 60)}ë¶„ ì „`;
        } else if (diffInSeconds < 86400) {
          return `${Math.floor(diffInSeconds / 3600)}ì‹œê°„ ì „`;
        } else if (diffInSeconds < 2592000) {
          return `${Math.floor(diffInSeconds / 86400)}ì¼ ì „`;
        } else {
          return date.toLocaleDateString('ko-KR', { 
            month: 'short', 
            day: 'numeric' 
          });
        }
      }
      
      initIndices() {
        this.loadEvents();
        setInterval(() => {
          this.loadEvents();
        }, 30000); // 30ì´ˆë§ˆë‹¤ ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸
      }
      
      async loadEvents() {
        const eventsContent = document.getElementById('events-content');
        
        try {
          // Firebase ì´ˆê¸°í™” í™•ì¸
          if (!window.firebaseInitialized || !window.firebaseDB || !window.firebaseCollection) {
            console.log('Firebase ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘...');
            setTimeout(() => this.loadEvents(), 1000);
            return;
          }
          
          // Firebaseì—ì„œ ì´ë²¤íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
          const eventsRef = window.firebaseCollection('events');
          const q = window.firebaseQuery(eventsRef, window.firebaseOrderBy('createdAt', 'desc'), window.firebaseLimit(5));
          const snapshot = await window.firebaseGetDocs(q);
          
          if (snapshot.empty) {
            eventsContent.innerHTML = `
              <div class="loading-indices">
                <i class="fas fa-calendar-alt"></i>
                <span>ë“±ë¡ëœ ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</span>
                <div style="font-size: 0.8rem; color: var(--text-muted); margin: 0.5rem 0;">
                  ìƒˆë¡œìš´ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”
                </div>
                <div class="events-view-all">
                  <a href="event-board.html" class="events-view-all-btn">
                    <i class="fas fa-plus"></i>
                    ì´ë²¤íŠ¸ ë“±ë¡í•˜ê¸°
                  </a>
                </div>
              </div>
            `;
            return;
          }
          
          const events = [];
          snapshot.forEach(doc => {
            const data = doc.data();
            events.push({
              id: doc.id,
              title: data.title,
              desc: data.desc,
              period: data.period,
              exchange: data.exchange,
              logo: data.logo,
              img: data.img,
              link: data.link,
              createdAt: data.createdAt
            });
          });
          
          const html = events.map(event => this.renderEventItem(event)).join('');
          eventsContent.innerHTML = html + `
            <div class="events-view-all">
              <a href="event-board.html" class="events-view-all-btn">
                <i class="fas fa-calendar-alt"></i>
                ëª¨ë“  ì´ë²¤íŠ¸ ë³´ê¸°
              </a>
            </div>
          `;
          
          // ì´ë²¤íŠ¸ ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
          document.querySelectorAll('.event-item').forEach(card => {
            card.addEventListener('click', () => {
              const link = card.dataset.link;
              if (link) {
                window.open(link, '_blank');
              }
            });
          });
          
          // ì´ë¯¸ì§€ ë¡œë”© ìƒíƒœ ê´€ë¦¬
          document.querySelectorAll('.event-image img').forEach(img => {
            img.classList.add('loading');
            
            img.onload = () => {
              img.classList.remove('loading');
              img.classList.add('loaded');
            };
            
            img.onerror = () => {
              img.classList.remove('loading');
              img.classList.add('error');
              img.src = '/assets/default-event-image.svg';
            };
          });
          
        } catch (error) {
          console.error('ì´ë²¤íŠ¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
          
          // Firebase ê´€ë ¨ ì˜¤ë¥˜ì¸ì§€ í™•ì¸
          const isFirebaseError = error.message && error.message.includes('collection');
          
          if (isFirebaseError) {
            eventsContent.innerHTML = `
            <div class="loading-indices">
              <i class="fas fa-exclamation-triangle"></i>
                <span>Firebase ì—°ê²° ì˜¤ë¥˜</span>
              <div style="font-size: 0.8rem; color: var(--text-muted); margin: 0.5rem 0;">
                  ì ì‹œ í›„ ìë™ìœ¼ë¡œ ì¬ì‹œë„ë©ë‹ˆë‹¤
              </div>
              </div>
            `;
            
            // 5ì´ˆ í›„ ì¬ì‹œë„
            setTimeout(() => {
              if (this && typeof this.loadEvents === 'function') {
                this.loadEvents();
              }
            }, 5000);
          } else {
            eventsContent.innerHTML = `
              <div class="loading-indices">
                <i class="fas fa-exclamation-triangle"></i>
                <span>ì´ë²¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</span>
                <button onclick="dashboard.loadEvents()" style="margin-top: 0.5rem; padding: 0.25rem 0.5rem; border: 1px solid var(--border-strong); border-radius: 4px; background: var(--bg-primary); color: var(--text-secondary); cursor: pointer;">
                <i class="fas fa-sync-alt"></i> ë‹¤ì‹œ ì‹œë„
              </button>
          </div>
        `;
          }
        }
      }
      
      renderEventItem(event) {
        const logoUrl = event.logo || '/assets/default-event-image.svg';
        const imageUrl = event.img || '/assets/default-event-image.svg';
        
        return `
          <div class="event-item" data-link="${event.link || ''}">
            <div class="event-content">
              <div class="event-header">
                <div class="event-info">
                  <div class="event-title">${event.title}</div>
                  <div class="event-desc">${event.desc}</div>
            </div>
                <div class="event-exchange">
                  <img class="event-exchange-logo" 
                       src="${logoUrl}" 
                       alt="${event.exchange}" 
                       loading="lazy"
                       onerror="this.src='/assets/default-event-image.svg'" />
                  <span class="event-exchange-name">${event.exchange}</span>
              </div>
            </div>
              <div class="event-meta">
                <div class="event-period">
                  <i class="fas fa-clock"></i>
                  <span>${event.period}</span>
              </div>
              </div>
            </div>
            <div class="event-image">
              <img src="${imageUrl}" 
                   alt="${event.title}" 
                   loading="lazy"
                   onerror="this.src='/assets/default-event-image.svg'" />
            </div>
          </div>
        `;
      }
      

      
      bindEvents() {
        // ì°¨íŠ¸ ì‹¬ë³¼ ë³€ê²½
        const chartSymbol = document.getElementById('chart-symbol');
        if (chartSymbol) {
          chartSymbol.addEventListener('change', (e) => {
            this.changeSymbol(e.target.value);
          });
        }
        
        // ë‰´ìŠ¤ ìƒˆë¡œê³ ì¹¨
        const refreshNews = document.getElementById('refresh-news');
        if (refreshNews) {
          refreshNews.addEventListener('click', () => {
            refreshNews.classList.add('loading');
            refreshNews.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            // ìºì‹œ í´ë¦¬ì–´
            localStorage.removeItem('indexNewsFeedsCache');
            
            this.loadNews().finally(() => {
              refreshNews.classList.remove('loading');
              refreshNews.innerHTML = '<i class="fas fa-sync-alt"></i>';
            });
          });
        }
        
        // ì´ë²¤íŠ¸ ìƒˆë¡œê³ ì¹¨
        const refreshEvents = document.getElementById('refresh-events');
        if (refreshEvents) {
          refreshEvents.addEventListener('click', () => {
            refreshEvents.classList.add('loading');
            this.loadEvents().finally(() => {
              refreshEvents.classList.remove('loading');
            });
          });
        }
      }
      
      changeSymbol(symbol) {
        this.currentSymbol = symbol;
        console.log('ì‹¬ë³¼ ë³€ê²½:', symbol);
        
        // ì „ì—­ ì°¨íŠ¸ ì‹¬ë³¼ ë³€ê²½ í•¨ìˆ˜ í˜¸ì¶œ
        if (typeof changeChartSymbol === 'function') {
          changeChartSymbol(symbol);
        } else {
          console.warn('changeChartSymbol í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      }
    }

    // ì½”ì¸ í…Œì´ë¸” ê¸°ëŠ¥
    class CryptoTable {
      constructor() {
        this.coins = [];
        this.filteredCoins = [];
        this.currentPage = 1;
        this.itemsPerPage = 50;
        this.sortField = 'rank';
        this.sortDirection = 'asc';
        this.currentCategory = 'all';
        this.searchTerm = '';
        
        this.init();
      }
      
      async init() {
        this.bindEvents();
        await this.loadData();
        this.render();
        
        // 5ë¶„ë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸ (ì„œë²„ ìºì‹œì™€ ë™ê¸°í™”)
        setInterval(() => {
          this.loadData();
        }, 300000);
      }
      
      bindEvents() {
        // íƒ­ ì „í™˜
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            this.currentCategory = e.target.dataset.category;
            this.currentPage = 1;
            this.filterAndSort();
          });
        });
        
        // ê²€ìƒ‰
        const searchInput = document.getElementById('coin-search');
        if (searchInput) {
        searchInput.addEventListener('input', (e) => {
          this.searchTerm = e.target.value.toLowerCase();
          this.currentPage = 1;
          this.filterAndSort();
        });
        }
        
        // ìƒˆë¡œê³ ì¹¨
        const refreshBtn = document.getElementById('refresh-data');
        if (refreshBtn) {
          refreshBtn.addEventListener('click', () => {
          this.loadData();
        });
        }
        
        // ì •ë ¬
        document.querySelectorAll('.sortable').forEach(th => {
          th.addEventListener('click', () => {
            const field = th.dataset.sort;
            if (this.sortField === field) {
              this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
              this.sortField = field;
              this.sortDirection = 'asc';
            }
            this.updateSortHeaders();
            this.filterAndSort();
          });
        });
        
        // í˜ì´ì§€ë„¤ì´ì…˜
        const prevBtn = document.getElementById('prev-page');
        const nextBtn = document.getElementById('next-page');
        
        if (prevBtn) {
          prevBtn.addEventListener('click', () => {
          if (this.currentPage > 1) {
            this.currentPage--;
            this.render();
          }
        });
        }
        
        if (nextBtn) {
          nextBtn.addEventListener('click', () => {
          const totalPages = Math.ceil(this.filteredCoins.length / this.itemsPerPage);
          if (this.currentPage < totalPages) {
            this.currentPage++;
            this.render();
          }
        });
        }
      }
      
      async loadData() {
        const refreshBtn = document.getElementById('refresh-data');
        if (refreshBtn) {
        refreshBtn.classList.add('loading');
        }
        
        try {
          console.log('CoinGecko APIì—ì„œ ì§ì ‘ ë°ì´í„° ë¡œë”© ì¤‘...');
          
          // ì§ì ‘ CoinGecko API í˜¸ì¶œ (ë¡œì»¬/í”„ë¡œë•ì…˜ ëª¨ë‘)
            const promises = [];
            for (let page = 1; page <= 2; page++) {
              promises.push(
                fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=250&page=${page}&sparkline=true&price_change_percentage=1h%2C24h%2C7d`)
                  .then(res => {
                    if (!res.ok) {
                      throw new Error(`API ì‘ë‹µ ì˜¤ë¥˜: ${res.status}`);
                    }
                    return res.json();
                  })
              );
            }
            
            const results = await Promise.allSettled(promises);
          let allData = [];
          
            for (const result of results) {
              if (result.status === 'fulfilled') {
                allData.push(...result.value);
              }
            }
            
          if (allData.length === 0) {
            throw new Error('ëª¨ë“  API ìš”ì²­ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
          }
          
            // ë°ì´í„° ì²˜ë¦¬
            const processedData = allData.map((coin, index) => ({
            id: coin.id,
              rank: coin.market_cap_rank || index + 1,
              name: coin.name?.replace(/['">\s]+/g, ' ').trim() || '',
              symbol: coin.symbol?.replace(/['">\s]+/g, ' ').trim().toUpperCase() || '',
            image: coin.image,
            price: coin.current_price,
            change1h: coin.price_change_percentage_1h_in_currency || 0,
            change24h: coin.price_change_percentage_24h || 0,
              change7d: coin.price_change_percentage_7d_in_currency || 0,
            volume: coin.total_volume,
              marketCap: coin.market_cap,
              sparkline: coin.sparkline_in_7d ? coin.sparkline_in_7d.price : [],
              lastUpdated: new Date().toISOString()
            }));
            
            // ì‹œê°€ì´ì•¡ ìˆœìœ¼ë¡œ ì •ë ¬
            processedData.sort((a, b) => (b.marketCap || 0) - (a.marketCap || 0));
            
            // ìˆœìœ„ ì¬ì •ë ¬
            processedData.forEach((coin, index) => {
              coin.rank = index + 1;
            });
            
            // ì¶”ê°€ ë°ì´í„° ê³„ì‚°
          const data = processedData.map(coin => ({
              ...coin,
              fundingRate: this.calculateFundingRate(coin),
            openInterest: this.calculateOpenInterest(coin),
            oiChange1h: this.calculateOIChange(coin, '1h'),
            oiChange4h: this.calculateOIChange(coin, '4h'),
            liquidation1h: this.calculateLiquidation(coin, '1h'),
              liquidation24h: this.calculateLiquidation(coin, '24h')
            }));
            
            console.log(`${data.length}ê°œ ì½”ì¸ ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ`);
          
          // ë°ì´í„° ë§¤í•‘
          this.coins = data.map(coin => ({
            id: coin.id,
            rank: coin.rank,
            name: coin.name,
            symbol: coin.symbol,
            image: coin.image,
            price: coin.price,
            change1h: coin.change1h,
            change24h: coin.change24h,
            fundingRate: coin.fundingRate,
            volume: coin.volume,
            openInterest: coin.openInterest,
            oiChange1h: coin.oiChange1h,
            oiChange4h: coin.oiChange4h,
            marketCap: coin.marketCap,
            liquidation1h: coin.liquidation1h,
            liquidation24h: coin.liquidation24h,
            sparkline: coin.sparkline || []
          }));
          
          this.filterAndSort();
          
        } catch (error) {
          console.error('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
          
          // ì—ëŸ¬ í‘œì‹œ
          const tbody = document.getElementById('crypto-table-body');
          if (tbody) {
            tbody.innerHTML = `
              <tr>
                <td colspan="14" class="loading-row" style="text-align: center; padding: 2rem;">
                  <div style="color: var(--text-secondary);">
                    <i class="fas fa-exclamation-triangle" style="margin-bottom: 0.5rem; font-size: 1.5rem;"></i>
                    <div>ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>
                    <div style="font-size: 0.9rem; margin-top: 0.5rem;">
                      CoinGecko API í˜¸ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
                    </div>
                    <button onclick="cryptoTable.loadData()" style="
                      margin-top: 1rem; 
                      padding: 0.5rem 1rem; 
                      border: 1px solid var(--border-strong); 
                      border-radius: 6px; 
                      background: var(--accent-blue); 
                      color: white; 
                      cursor: pointer;
                      font-size: 0.9rem;
                    ">
                      <i class="fas fa-sync-alt"></i> ë‹¤ì‹œ ì‹œë„
                    </button>
                  </div>
                </td>
              </tr>
            `;
          }
        } finally {
          if (refreshBtn) {
          refreshBtn.classList.remove('loading');
          }
        }
      }
      

      
      filterAndSort() {
        let filtered = [...this.coins];
        
               // ì¹´í…Œê³ ë¦¬ í•„í„°ë§
         switch (this.currentCategory) {
           case 'gainers':
             filtered = filtered.filter(coin => coin.change24h > 0);
             break;
           case 'losers':
             filtered = filtered.filter(coin => coin.change24h < 0);
             break;
         }
        
        // ê²€ìƒ‰ í•„í„°ë§
        if (this.searchTerm) {
          filtered = filtered.filter(coin => 
            coin.name.toLowerCase().includes(this.searchTerm) ||
            coin.symbol.toLowerCase().includes(this.searchTerm)
          );
        }
        
        // ì •ë ¬
        filtered.sort((a, b) => {
          let aVal = a[this.sortField];
          let bVal = b[this.sortField];
          
          if (typeof aVal === 'string') {
            aVal = aVal.toLowerCase();
            bVal = bVal.toLowerCase();
          }
          
          if (this.sortDirection === 'asc') {
            return aVal > bVal ? 1 : -1;
          } else {
            return aVal < bVal ? 1 : -1;
          }
        });
        
        this.filteredCoins = filtered;
        this.currentPage = 1;
        this.render();
      }
      
      render() {
        const tbody = document.getElementById('crypto-table-body');
        if (!tbody) return;
        
        const startIndex = (this.currentPage - 1) * this.itemsPerPage;
        const endIndex = startIndex + this.itemsPerPage;
        const pageCoins = this.filteredCoins.slice(startIndex, endIndex);
        
        if (pageCoins.length === 0) {
                     tbody.innerHTML = `
             <tr>
               <td colspan="14" class="loading-row">
                 ${this.coins.length === 0 ? 
                   '<div class="loading-spinner"></div> ë°ì´í„° ë¡œë”© ì¤‘...' : 
                   'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.'
                 }
               </td>
             </tr>
           `;
          return;
        }
        
                 tbody.innerHTML = pageCoins.map(coin => {
           const fallbackSvg = this.createFallbackSvg(coin.symbol);
           return `
           <tr data-coin-id="${coin.id}" ${coin.id === 'bitcoin' ? 'style="cursor: pointer;" onclick="window.location.href=\'/currencies/bitcoin/\'"' : ''}>
             <td>${coin.rank}</td>
             <td>
               <div class="coin-info">
                 <img src="${coin.image}" alt="${coin.name}" class="coin-logo" 
                      onerror="this.src='${fallbackSvg}'">
                 <div class="coin-details">
                   <div class="coin-name">${coin.name}</div>
                   <div class="coin-symbol">${coin.symbol}</div>
                 </div>
               </div>
             </td>
             <td class="price">$${this.formatPrice(coin.price)}</td>
             <td><span class="change ${this.getChangeClass(coin.change1h)}">${this.formatPercent(coin.change1h)}</span></td>
             <td><span class="change ${this.getChangeClass(coin.change24h)}">${this.formatPercent(coin.change24h)}</span></td>
             <td><span class="change ${this.getChangeClass(coin.fundingRate)}">${this.formatPercent(coin.fundingRate)}</span></td>
             <td class="volume">$${this.formatNumber(coin.volume)}</td>
             <td class="oi">$${this.formatNumber(coin.openInterest)}</td>
             <td><span class="change ${this.getChangeClass(coin.oiChange1h)}">${this.formatPercent(coin.oiChange1h)}</span></td>
             <td><span class="change ${this.getChangeClass(coin.oiChange4h)}">${this.formatPercent(coin.oiChange4h)}</span></td>
             <td class="market-cap">$${this.formatNumber(coin.marketCap)}</td>
             <td class="liquidation">$${this.formatNumber(coin.liquidation1h)}</td>
             <td class="liquidation">$${this.formatNumber(coin.liquidation24h)}</td>
             <td>
               <canvas class="mini-chart" width="60" height="30" 
                      onclick="window.open('https://www.tradingview.com/chart/?symbol=BINANCE:${coin.symbol}USDT', '_blank')"
                       data-sparkline='${JSON.stringify(coin.sparkline)}'></canvas>
             </td>
           </tr>
           `;
         }).join('');
        
        // ë¯¸ë‹ˆ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        this.drawMiniCharts();
        
        // í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸
        this.updatePagination();
      }
      
      drawMiniCharts() {
        document.querySelectorAll('.mini-chart').forEach(canvas => {
          const sparkline = JSON.parse(canvas.dataset.sparkline || '[]');
          if (!sparkline || sparkline.length === 0) return;
          
          const ctx = canvas.getContext('2d');
          const width = canvas.width;
          const height = canvas.height;
          
          ctx.clearRect(0, 0, width, height);
          
          const min = Math.min(...sparkline);
          const max = Math.max(...sparkline);
          const range = max - min;
          
          if (range === 0) return;
          
          ctx.strokeStyle = sparkline[sparkline.length - 1] > sparkline[0] ? '#10b981' : '#ef4444';
          ctx.lineWidth = 1.5;
          ctx.beginPath();
          
          sparkline.forEach((price, index) => {
            const x = (index / (sparkline.length - 1)) * width;
            const y = height - ((price - min) / range) * height;
            
            if (index === 0) {
              ctx.moveTo(x, y);
            } else {
              ctx.lineTo(x, y);
            }
          });
          
          ctx.stroke();
        });
      }
      
      updateSortHeaders() {
        document.querySelectorAll('.sortable').forEach(th => {
          th.classList.remove('sort-asc', 'sort-desc');
          if (th.dataset.sort === this.sortField) {
            th.classList.add(`sort-${this.sortDirection}`);
          }
        });
      }
      
      updatePagination() {
        const totalPages = Math.ceil(this.filteredCoins.length / this.itemsPerPage);
        
        const prevBtn = document.getElementById('prev-page');
        const nextBtn = document.getElementById('next-page');
        const pageInfo = document.getElementById('page-info');
        
        if (prevBtn) prevBtn.disabled = this.currentPage === 1;
        if (nextBtn) nextBtn.disabled = this.currentPage === totalPages || totalPages === 0;
        if (pageInfo) {
          const startItem = (this.currentPage - 1) * this.itemsPerPage + 1;
          const endItem = Math.min(this.currentPage * this.itemsPerPage, this.filteredCoins.length);
          pageInfo.textContent = `${startItem}-${endItem} / ${this.filteredCoins.length} (í˜ì´ì§€ ${this.currentPage}/${totalPages || 1})`;
        }
      }
      
      formatPrice(price) {
        if (price >= 1) {
          return price.toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
          });
        } else {
          return price.toFixed(6);
        }
      }
      
      formatPercent(percent) {
        const sign = percent >= 0 ? '+' : '';
        return `${sign}${percent.toFixed(2)}%`;
      }
      
      formatNumber(num) {
        if (num >= 1e12) {
          return (num / 1e12).toFixed(2) + 'T';
        } else if (num >= 1e9) {
          return (num / 1e9).toFixed(2) + 'B';
        } else if (num >= 1e6) {
          return (num / 1e6).toFixed(2) + 'M';
        } else if (num >= 1e3) {
          return (num / 1e3).toFixed(2) + 'K';
        } else {
          return num.toLocaleString();
        }
      }
      
      getChangeClass(change) {
        if (change > 0) return 'positive';
        if (change < 0) return 'negative';
        return 'neutral';
      }
      
      // í…ìŠ¤íŠ¸ ì •ë¦¬ í•¨ìˆ˜ (B'"> ì˜¤ë¥˜ í•´ê²°)
      cleanText(text) {
        if (!text) return '';
        return text
          .replace(/[A-Z]'">/g, '') // B'"> ê°™ì€ íŒ¨í„´ ì œê±°
          .replace(/['">\s]+/g, ' ') // ë”°ì˜´í‘œ, êº½ì‡ , ê³µë°± ì •ë¦¬
          .trim();
      }
      
      // ë°±ì—… SVG ìƒì„±
      createFallbackSvg(symbol) {
        const firstChar = symbol ? symbol.charAt(0) : '?';
        const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
          <circle cx="16" cy="16" r="16" fill="#ddd"/>
          <text x="16" y="20" text-anchor="middle" fill="#999" font-size="10">${firstChar}</text>
        </svg>`;
        return 'data:image/svg+xml,' + encodeURIComponent(svg);
      }
      
      // ì¶”ê°€ ë°ì´í„° ê³„ì‚° í•¨ìˆ˜ë“¤
      calculateFundingRate(coin) {
        const volatility = Math.abs(coin.change24h || 0);
        const volumeRatio = Math.min((coin.volume || 0) / (coin.marketCap || 1), 1);
        
        let funding = (Math.sin(coin.rank || 1) * 0.05) + (volatility * 0.01);
        funding *= (1 + volumeRatio * 0.5);
        
        return Math.max(-0.1, Math.min(0.1, funding));
      }
      
      calculateOpenInterest(coin) {
        const baseRatio = 0.08;
        const volumeBoost = Math.min((coin.volume || 0) / (coin.marketCap || 1), 0.5) * 0.1;
        const rankBoost = Math.max(0, (100 - (coin.rank || 100)) / 1000);
        
        return (coin.marketCap || 0) * (baseRatio + volumeBoost + rankBoost);
      }

      calculateOIChange(coin, period) {
        const priceChange = period === '1h' ? 
          (coin.change1h || 0) : 
          (coin.change24h || 0) / 4;
        
        const correlation = -0.3 + (Math.random() * 0.6);
        return priceChange * correlation;
      }
      
      calculateLiquidation(coin, period) {
        const volatility = Math.abs(coin.change24h || 0);
        const volume = coin.volume || 0;
        
        const liquidationRatio = Math.min(volatility * 0.02, 0.1);
        const baseLiquidation = volume * liquidationRatio;
        
        return period === '24h' ? baseLiquidation : baseLiquidation / 24;
      }
      

      
      // TradingView ì—´ê¸°
      openTradingView(symbol) {
        const url = `https://www.tradingview.com/chart/?symbol=BINANCE:${symbol}`;
        window.open(url, '_blank');
      }
    }

    // í˜ì´ì§€ ë¡œë“œ í›„ ì´ˆê¸°í™”
    let dashboard;
    let cryptoTable;
    
    // ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” í•¨ìˆ˜
    function initializeDashboard() {
      // ë¶„ë´‰ ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      const timeframeSelect = document.getElementById('chart-timeframe');
      if (timeframeSelect) {
        timeframeSelect.addEventListener('change', function() {
          const timeframe = this.value;
          changeTimeframe(timeframe);
        });
      }
      
      // ì°¨íŠ¸ ì‹¬ë³¼ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      const chartSymbol = document.getElementById('chart-symbol');
      if (chartSymbol) {
        chartSymbol.addEventListener('change', function() {
          const symbol = this.value;
          changeChartSymbol(symbol);
        });
      }
      
      // ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
      try {
        dashboard = new Dashboard();
      } catch (error) {
        console.error('Dashboard ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
      }
      
      // ì½”ì¸ í…Œì´ë¸” ì´ˆê¸°í™”
      setTimeout(() => {
        try {
          cryptoTable = new CryptoTable();
        } catch (error) {
          console.error('CryptoTable ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        }
      }, 1000);
    }
    
    // Firebase ì´ˆê¸°í™” ì™„ë£Œ í›„ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      // Firebaseê°€ ì´ë¯¸ ì´ˆê¸°í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸
      if (window.firebaseInitialized && window.firebaseDB) {
        initializeDashboard();
      } else {
        // Firebase ì´ˆê¸°í™”ë¥¼ ê¸°ë‹¤ë¦¼
        const checkFirebase = setInterval(() => {
          if (window.firebaseInitialized && window.firebaseDB) {
            clearInterval(checkFirebase);
            initializeDashboard();
          }
        }, 100);
        
        // Firebase ì´ˆê¸°í™” ì™„ë£Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.addEventListener('firebaseInitialized', function() {
          clearInterval(checkFirebase);
          initializeDashboard();
        });
        
        // 10ì´ˆ í›„ íƒ€ì„ì•„ì›ƒ
        setTimeout(() => {
          clearInterval(checkFirebase);
          console.warn('Firebase ì´ˆê¸°í™” íƒ€ì„ì•„ì›ƒ');
          initializeDashboard(); // Firebase ì—†ì´ë„ ë‹¤ë¥¸ ê¸°ëŠ¥ë“¤ì€ ì´ˆê¸°í™”
        }, 10000);
      }
    });
    
    // ë³µë¦¬ ê³„ì‚°ê¸° ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      // ë³µë¦¬ ê³„ì‚°ê¸° ì´ˆê¸°í™”
      if (typeof window.CompoundCalculator !== 'undefined') {
        window.compoundCalculator = new window.CompoundCalculator();
        console.log('ğŸ’° ë³µë¦¬ ê³„ì‚°ê¸° ì´ˆê¸°í™” ì™„ë£Œ');
      } else {
        console.warn('ë³µë¦¬ ê³„ì‚°ê¸° í´ë˜ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }
    });
  </script>
</body>
</html>