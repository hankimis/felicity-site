---
description:
globs:
alwaysApply: false
---
# ğŸš€ ì´ë¯¸ì§€ ì„±ëŠ¥ ìµœì í™” ì‹œìŠ¤í…œ ê·œì¹™

## ğŸ“‹ ê°œìš”
ì´ë²¤íŠ¸ í˜ì´ì§€ ì´ë¯¸ì§€ ë¡œë”© ì„±ëŠ¥ì„ ìµœì í™”í•˜ê¸° ìœ„í•œ í¬ê´„ì ì¸ ì‹œìŠ¤í…œ ê·œì¹™ì…ë‹ˆë‹¤.

## ğŸ¯ í•µì‹¬ ìµœì í™” ê¸°ë²•

### 1. ğŸ”„ Lazy Loading ì‹œìŠ¤í…œ
```javascript
// âœ… ì˜¬ë°”ë¥¸ Lazy Loading êµ¬í˜„
class ImageOptimizer {
  initLazyLoading() {
    this.observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          this.loadImage(entry.target);
          this.observer.unobserve(entry.target);
        }
      });
    }, {
      rootMargin: '50px 0px',  // 50px ë¯¸ë¦¬ ë¡œë“œ
      threshold: 0.1
    });
  }
}

// âŒ í”¼í•´ì•¼ í•  íŒ¨í„´
img.src = url; // ì¦‰ì‹œ ë¡œë“œ (ì„±ëŠ¥ ì €í•˜)
```

### 2. ğŸ–¼ï¸ ì´ë¯¸ì§€ ì••ì¶• & í˜•ì‹ ìµœì í™”
```javascript
// âœ… ì´ë¯¸ì§€ ì••ì¶• ë° WebP ë³€í™˜
async compressImage(file, maxWidth = 800, maxHeight = 600, quality = 0.8) {
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  
  // ë¹„ìœ¨ ìœ ì§€í•˜ë©´ì„œ í¬ê¸° ì¡°ì •
  const ratio = Math.min(maxWidth / img.width, maxHeight / img.height);
  canvas.width = img.width * ratio;
  canvas.height = img.height * ratio;
  
  // WebP ì§€ì› ì‹œ WebPë¡œ ë³€í™˜
  const mimeType = this.supportsWebP() ? 'image/webp' : 'image/jpeg';
  return new Promise(resolve => {
    canvas.toBlob(resolve, mimeType, quality);
  });
}

// âŒ ì••ì¶• ì—†ì´ ì—…ë¡œë“œ
uploadTask = uploadBytesResumable(storageRef, file); // ì›ë³¸ í¬ê¸° ì—…ë¡œë“œ
```

### 3. ğŸ”— Firebase Storage URL ìµœì í™”
```javascript
// âœ… Firebase Storage ì´ë¯¸ì§€ ë³€í™˜ íŒŒë¼ë¯¸í„°
optimizeImageUrl(url, width = 400, height = 400) {
  const urlObj = new URL(url);
  urlObj.searchParams.set('w', width.toString());
  urlObj.searchParams.set('h', height.toString());
  urlObj.searchParams.set('fit', 'cover');
  urlObj.searchParams.set('q', '85'); // í’ˆì§ˆ 85%
  
  if (this.supportsWebP()) {
    urlObj.searchParams.set('format', 'webp');
  }
  
  return urlObj.toString();
}

// âŒ ì›ë³¸ URL ì‚¬ìš©
<img src={originalUrl} /> // ìµœì í™” ì—†ìŒ
```

### 4. ğŸ’¾ ìºì‹± ì „ëµ
```javascript
// âœ… ë‹¤ì¸µ ìºì‹± ì‹œìŠ¤í…œ
class ImageOptimizer {
  constructor() {
    this.imageCache = new Map();        // ë©”ëª¨ë¦¬ ìºì‹œ
    this.loadingImages = new Set();     // ì¤‘ë³µ ë¡œë”© ë°©ì§€
  }
  
  async loadImage(imgElement) {
    // 1. ë©”ëª¨ë¦¬ ìºì‹œ í™•ì¸
    if (this.imageCache.has(src)) {
      imgElement.src = this.imageCache.get(src);
      return;
    }
    
    // 2. Service Worker ìºì‹œ í™œìš©
    // 3. ë„¤íŠ¸ì›Œí¬ ìš”ì²­ (ìµœí›„)
  }
}

// âŒ ìºì‹œ ì—†ì´ ë§¤ë²ˆ ë¡œë“œ
fetch(imageUrl); // ë§¤ë²ˆ ë„¤íŠ¸ì›Œí¬ ìš”ì²­
```

### 5. ğŸ¨ ë¡œë”© ìƒíƒœ UI
```css
/* âœ… ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
.lazy-image {
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: loading-shimmer 1.5s infinite;
}

.lazy-image.loaded {
  opacity: 1;
  animation: none;
  background: none;
}

@keyframes loading-shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

/* âŒ ë¡œë”© ìƒíƒœ ì—†ìŒ */
img { opacity: 1; } /* ë¡œë”© ì¤‘ì—ë„ íˆ¬ëª…ë„ 1 */
```

## ğŸ› ï¸ Service Worker ìºì‹±

### ìºì‹œ ì „ëµ
```javascript
// âœ… ì´ë¯¸ì§€ ì „ìš© Service Worker
const CACHE_NAME = 'felicity-images-v1';
const MAX_CACHE_SIZE = 100;

self.addEventListener('fetch', (event) => {
  if (isImageRequest(event.request)) {
    event.respondWith(
      caches.open(CACHE_NAME).then(async (cache) => {
        // ìºì‹œ ìš°ì„ , ë„¤íŠ¸ì›Œí¬ í´ë°±
        const cachedResponse = await cache.match(event.request);
        if (cachedResponse) return cachedResponse;
        
        const response = await fetch(event.request);
        if (response.ok) {
          cache.put(event.request, response.clone());
        }
        return response;
      })
    );
  }
});
```

### ìºì‹œ ê´€ë¦¬
```javascript
// âœ… ìºì‹œ í¬ê¸° ì œí•œ
async function manageCacheSize() {
  const cache = await caches.open(CACHE_NAME);
  const keys = await cache.keys();
  
  if (keys.length > MAX_CACHE_SIZE) {
    const keysToDelete = keys.slice(0, keys.length - MAX_CACHE_SIZE);
    await Promise.all(keysToDelete.map(key => cache.delete(key)));
  }
}
```

## ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

### ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
```javascript
// âœ… ì´ë¯¸ì§€ ë¡œë”© ì„±ëŠ¥ ì¶”ì 
class ImagePerformanceMonitor {
  constructor() {
    this.metrics = {
      totalImages: 0,
      loadedImages: 0,
      failedImages: 0,
      cacheHits: 0,
      totalLoadTime: 0,
      averageLoadTime: 0
    };
  }
  
  startLoading(url) {
    this.loadStartTimes.set(url, performance.now());
    this.metrics.totalImages++;
  }
  
  finishLoading(url, fromCache = false) {
    const loadTime = performance.now() - this.loadStartTimes.get(url);
    this.metrics.totalLoadTime += loadTime;
    this.metrics.loadedImages++;
    
    if (fromCache) this.metrics.cacheHits++;
  }
}
```

### ì„±ëŠ¥ ë””ë²„ê¹…
```javascript
// âœ… ì‹¤ì‹œê°„ ì„±ëŠ¥ ë””ë²„ê±°
class ImageDebugger {
  createDebugPanel() {
    const panel = document.createElement('div');
    panel.innerHTML = `
      <h4>ğŸš€ ì´ë¯¸ì§€ ì„±ëŠ¥ ë””ë²„ê±°</h4>
      <div id="debug-stats">
        <div>ì´ ì´ë¯¸ì§€: ${report.totalImages}</div>
        <div>ìºì‹œ íˆíŠ¸ìœ¨: ${report.cacheHitRate}%</div>
        <div>í‰ê·  ë¡œë”© ì‹œê°„: ${report.averageLoadTime.toFixed(0)}ms</div>
      </div>
    `;
  }
}

// ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™”: Ctrl+Shift+I
```

## ğŸ¯ HTML ìµœì í™”

### ì´ë¯¸ì§€ íƒœê·¸ ìµœì í™”
```html
<!-- âœ… ìµœì í™”ëœ ì´ë¯¸ì§€ íƒœê·¸ -->
<img class="event-card-img lazy-image" 
     data-src="${optimizedImgUrl}" 
     alt="${data.exchange} Event" 
     loading="lazy"
     decoding="async" />

<!-- âŒ ê¸°ë³¸ ì´ë¯¸ì§€ íƒœê·¸ -->
<img src="${data.img}" alt="Event" />
```

### ë¦¬ì†ŒìŠ¤ íŒíŠ¸
```html
<!-- âœ… ì„±ëŠ¥ ìµœì í™” ë©”íƒ€ íƒœê·¸ -->
<link rel="preconnect" href="https://firebasestorage.googleapis.com">
<link rel="dns-prefetch" href="https://firebasestorage.googleapis.com">
<link rel="preload" href="/assets/default-event-image.svg" as="image">
```

## ğŸš« ê¸ˆì§€ ì‚¬í•­

### âŒ í”¼í•´ì•¼ í•  íŒ¨í„´
1. **ì¦‰ì‹œ ë¡œë“œ**: ëª¨ë“  ì´ë¯¸ì§€ë¥¼ í•œ ë²ˆì— ë¡œë“œ
2. **ì••ì¶• ì—†ìŒ**: ì›ë³¸ í¬ê¸° ì´ë¯¸ì§€ ì—…ë¡œë“œ
3. **ìºì‹œ ë¬´ì‹œ**: ë§¤ë²ˆ ë„¤íŠ¸ì›Œí¬ ìš”ì²­
4. **ë¡œë”© ìƒíƒœ ì—†ìŒ**: ì‚¬ìš©ìì—ê²Œ ì§„í–‰ ìƒí™© ë¯¸í‘œì‹œ
5. **ì—ëŸ¬ ì²˜ë¦¬ ì—†ìŒ**: ì´ë¯¸ì§€ ë¡œë”© ì‹¤íŒ¨ ì‹œ ëŒ€ì‘ ì—†ìŒ

### âŒ ì„±ëŠ¥ ì €í•˜ ì½”ë“œ
```javascript
// ëª¨ë“  ì´ë¯¸ì§€ ì¦‰ì‹œ ë¡œë“œ
images.forEach(img => img.src = img.dataset.src);

// ì••ì¶• ì—†ì´ ì—…ë¡œë“œ
uploadBytes(storageRef, file);

// ìºì‹œ ë¬´ì‹œ
fetch(url, { cache: 'no-cache' });
```

## ğŸ¯ ì„±ëŠ¥ ëª©í‘œ

### ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ
- **ë¡œë”© ì‹œê°„**: í‰ê·  500ms ì´í•˜
- **ìºì‹œ íˆíŠ¸ìœ¨**: 70% ì´ìƒ
- **ì„±ê³µë¥ **: 95% ì´ìƒ
- **ì••ì¶•ë¥ **: ì›ë³¸ ëŒ€ë¹„ 60% ì´í•˜

### ğŸ† ìµœì í™” ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] Lazy Loading êµ¬í˜„
- [ ] ì´ë¯¸ì§€ ì••ì¶• ì ìš©
- [ ] WebP í˜•ì‹ ì§€ì›
- [ ] Service Worker ìºì‹±
- [ ] ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- [ ] ì—ëŸ¬ ì²˜ë¦¬
- [ ] ë¡œë”© ìƒíƒœ UI
- [ ] ë””ë²„ê¹… ë„êµ¬

## ğŸ”§ ë””ë²„ê¹… & ëª¨ë‹ˆí„°ë§

### ì„±ëŠ¥ ë¶„ì„ ë„êµ¬
```javascript
// ì„±ëŠ¥ ë¦¬í¬íŠ¸ ìƒì„±
performanceMonitor.getReport();

// ìµœì í™” ì œì•ˆ ë°›ê¸°
performanceMonitor.getSuggestions();

// ìºì‹œ ìƒíƒœ í™•ì¸
imageDebugger.getCacheStatus();
```

### ë¬¸ì œ í•´ê²° ê°€ì´ë“œ
1. **ëŠë¦° ë¡œë”©**: ì´ë¯¸ì§€ í¬ê¸° ë° ì••ì¶• í™•ì¸
2. **ìºì‹œ ë¯¸ìŠ¤**: Service Worker ìƒíƒœ í™•ì¸
3. **ë¡œë”© ì‹¤íŒ¨**: ë„¤íŠ¸ì›Œí¬ ë° URL ìœ íš¨ì„± í™•ì¸
4. **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜**: ìºì‹œ í¬ê¸° ì œí•œ í™•ì¸

ì´ ê·œì¹™ë“¤ì„ ì¤€ìˆ˜í•˜ì—¬ ì´ë¯¸ì§€ ë¡œë”© ì„±ëŠ¥ì„ ìµœì í™”í•˜ê³ , ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒì‹œí‚¤ì„¸ìš”.
